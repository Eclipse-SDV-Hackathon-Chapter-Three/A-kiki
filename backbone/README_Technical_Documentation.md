# Enhanced Police Monitoring System - Technical Documentation

## ì‹œìŠ¤í…œ ê°œìš” (System Overview)

ì´ í”„ë¡œì íŠ¸ëŠ” **Enhanced Police Monitoring System**ìœ¼ë¡œ, CARLA ì‹œë®¬ë ˆì´í„°, ROS2, KUKSA, zenoh, ê·¸ë¦¬ê³  ì›¹ ê¸°ìˆ ì„ í†µí•©í•˜ì—¬ ì‹¤ì‹œê°„ ê²½ì°°ì°¨ëŸ‰ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•œ í¬ê´„ì ì¸ ì†”ë£¨ì…˜ì…ë‹ˆë‹¤. ì‹œìŠ¤í…œì˜ ë©”ì¸ íŒŒì¼ì€ `run_enhanced_police_system.py`ì…ë‹ˆë‹¤.

## ì•„í‚¤í…ì²˜ (Architecture)

### ì‹¤ì œ ì‹œìŠ¤í…œ êµ¬ì„±ë„ (Actual System Architecture)

**âœ… í†µí•© ì™„ë£Œ**: CARLA ì‹œë®¬ë ˆì´ì…˜ ê¸°ë°˜ VSS ê²½ì°° ë°ì´í„° **í†µí•© ì‹œìŠ¤í…œ**

```
â”Œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”
â”‚                    Enhanced Police Monitoring System                             â”‚
â”‚                       (run_enhanced_police_system.py)                           â”‚
â””â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”˜

                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚   CARLA Simulator   â”‚
                                â”‚  (localhost:2000)   â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚       carla_vehicle_spawner.py          â”‚
                       â”‚           (INTEGRATED)                  â”‚
                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                       â”‚ â€¢ Tesla Model 3 ê²½ì°°ì°¨ ìŠ¤í°               â”‚
                       â”‚ â€¢ ì¹´ë©”ë¼/ì„¼ì„œ ì„¤ì •                        â”‚
                       â”‚ â€¢ CARLA ë°ì´í„° â†’ VSS ë°ì´í„° í†µí•© ìƒì„±        â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚         ROS2 Message Layer              â”‚
                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                       â”‚ â€¢ /carla/hero/camera/* â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”
                       â”‚ â€¢ /carla/hero/vehicle_status             â”‚  â”‚
                       â”‚ â€¢ police/vss_data                        â”‚  â”‚
                       â”‚ â€¢ police/status                          â”‚  â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                 â”‚                       â”‚           â”‚
                                 â–¼                       â–¼           â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
           â”‚   C++ SHM ì¹´ë©”ë¼ ë¸Œë¦¬ì§€        â”‚    â”‚    kuksa_zenoh_bridge.py    â”‚  â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
           â”‚                             â”‚    â”‚ â€¢ VSS ìŠ¤í‚¤ë§ˆ ê²€ì¦             â”‚  â”‚
           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â€¢ ì‘ê¸‰ìƒí™© ê°ì§€              â”‚  â”‚
           â”‚ â”‚  ros2_zenoh_shm_pub     â”‚ â”‚    â”‚ â€¢ zenoh Topics ë°œí–‰:        â”‚  â”‚
           â”‚ â”‚  â€¢ Camera êµ¬ë…          â”‚ â”‚    â”‚   - police/central/vehicle/ â”‚  â”‚
           â”‚ â”‚  â€¢ SHM ì „ì†¡ (67MB)     â”‚ â”‚    â”‚     UNIT-001/vss           â”‚  â”‚
           â”‚ â”‚  â€¢ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼        â”‚ â”‚    â”‚   - police/central/alerts/  â”‚  â”‚
           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚     emergency/UNIT-001      â”‚  â”‚
           â”‚           â”‚                 â”‚    â”‚   - police/central/fleet/   â”‚  â”‚
           â”‚           â–¼                 â”‚    â”‚     status                  â”‚  â”‚
           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
           â”‚ â”‚  zenoh_ws_shm_sub       â”‚ â”‚                  â”‚                  â”‚
           â”‚ â”‚  â€¢ SHM êµ¬ë…             â”‚ â”‚                  â–¼                  â”‚
           â”‚ â”‚  â€¢ WebSocket ì„œë²„       â”‚ â”‚                                     â”‚
           â”‚ â”‚  â€¢ í¬íŠ¸ 8080           â”‚ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚  police_websocket_bridge.py â”‚  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
                       â”‚                      â”‚ â€¢ zenoh êµ¬ë…:               â”‚  â”‚
                       â”‚                      â”‚   - police/central/*        â”‚  â”‚
                       â”‚                      â”‚ â€¢ WebSocket ì„œë²„            â”‚  â”‚
                       â”‚                      â”‚ â€¢ í¬íŠ¸ 8081                 â”‚  â”‚
                       â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                       â”‚                                    â”‚                  â”‚
                       â”‚                                    â–¼                  â”‚
                       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜
                       â”‚              â”‚            zenoh Network                â”‚
                       â”‚              â”‚          (ê³ ì„±ëŠ¥ ë°±ë³¸)                   â”‚
                       â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                       â”‚              â”‚ â€¢ SHM: ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ (67MB)               â”‚
                       â”‚              â”‚ â€¢ Messages: VSS ê²½ì°° ë°ì´í„°              â”‚
                       â”‚              â”‚ â€¢ Topics:                              â”‚
                       â”‚              â”‚   - police/central/vehicle/*           â”‚
                       â”‚              â”‚   - police/central/alerts/*            â”‚
                       â”‚              â”‚   - police/central/fleet/*             â”‚
                       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                                    â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚          Web Interface Layer            â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚                                         â”‚
                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚ â”‚    police_dashboard_enhanced.html   â”‚ â”‚
                    â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
                    â”‚ â”‚                                     â”‚ â”‚
                    â”‚ â”‚ WebSocket 8080 â”€â”€â–º ì‹¤ì‹œê°„ ì¹´ë©”ë¼       â”‚ â”‚
                    â”‚ â”‚                   ìŠ¤íŠ¸ë¦¼ (CARLA)      â”‚ â”‚
                    â”‚ â”‚                         +           â”‚ â”‚
                    â”‚ â”‚ WebSocket 8081 â”€â”€â–º VSS ê²½ì°° ë°ì´í„°    â”‚ â”‚
                    â”‚ â”‚                   (CARLA ê¸°ë°˜)      â”‚ â”‚
                    â”‚ â”‚                         â•‘          â”‚ â”‚
                    â”‚ â”‚                         â–¼          â”‚ â”‚
                    â”‚ â”‚ í†µí•© ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ:                 â”‚ â”‚
                    â”‚ â”‚ â€¢ ì°¨ëŸ‰ ìœ„ì¹˜ ì¶”ì                      â”‚ â”‚
                    â”‚ â”‚ â€¢ ì‘ê¸‰ìƒí™© ì•Œë¦¼                      â”‚ â”‚
                    â”‚ â”‚ â€¢ ì¥ë¹„ ìƒíƒœ ëª¨ë‹ˆí„°ë§                  â”‚ â”‚
                    â”‚ â”‚ â€¢ ë¼ì´ë¸Œ ì¹´ë©”ë¼ í”¼ë“œ                  â”‚ â”‚
                    â”‚ â”‚ â€¢ VSS ì¤€ìˆ˜ ë°ì´í„° ì‹œê°í™”              â”‚ â”‚
                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š **í†µí•©ëœ ë°ì´í„° í”Œë¡œìš°** (Integrated Data Flow)

```
CARLA Simulator
        â”‚
        â–¼
carla_vehicle_spawner.py (í†µí•© ë²„ì „)
        â”‚
        â”œâ”€ /carla/hero/camera/* â”€â”€â–º ros2_zenoh_shm_pub â”€â”€â–º zenoh SHM â”€â”€â–º WebSocket(8080)
        â”‚                                                                         â”‚
        â”œâ”€ police/vss_data â”€â”€â”€â”€â”€â”€â”€â”€â–º kuksa_zenoh_bridge.py â”€â”€â–º zenoh Topics â”€â”€â–º WebSocket(8081)
        â”‚                                    â”‚                        â”‚              â”‚
        â””â”€ police/status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                        â–¼              â”‚
                                           â”‚              police/central/vehicle/*    â”‚
                                           â”‚              police/central/alerts/*     â”‚
                                           â–¼              police/central/fleet/*      â”‚
                                   police_websocket_bridge.py                      â”‚
                                           â”‚                                         â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                  â”‚
                                                                  â–¼
                                                 police_dashboard_enhanced.html
                                                 (í†µí•© ì‹¤ì‹œê°„ ê²½ì°° ëª¨ë‹ˆí„°ë§)
```

## í•µì‹¬ ê°œì„ ì‚¬í•­ (Key Improvements)

### 1. **âœ… í†µí•©ëœ ë°ì´í„° í”Œë¡œìš°**
- **í†µí•© CARLA-VSS**: ì‹¤ì œ ì°¨ëŸ‰ ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ VSS ë°ì´í„° ìƒì„±
- **ì‹¤ì‹œê°„ ì—°ë™**: CARLA ì°¨ëŸ‰ ìƒíƒœê°€ VSS ê²½ì°° ë°ì´í„°ì— ì§ì ‘ ë°˜ì˜
- **ì¼ê´€ì„± ë³´ì¥**: ìœ„ì¹˜, ì†ë„, ìƒíƒœê°€ ëª¨ë“  ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì—ì„œ ë™ì¼

### 2. **âœ… CARLA ê¸°ë°˜ VSS í†µí•©**
- `carla_vehicle_spawner.py`: í†µí•©ëœ ì°¨ëŸ‰ ìŠ¤í° + VSS ë°ì´í„° ìƒì„±
- `police_vss_data_publisher.py`: **ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (DEPRECATED)**
- ì‹¤ì œ CARLA ì°¨ëŸ‰ ë°ì´í„° â†’ VSS í¬ë§· ì‹¤ì‹œê°„ ë³€í™˜
- ê²½ì°° ì‹œë‚˜ë¦¬ì˜¤ê°€ ì‹¤ì œ ì°¨ëŸ‰ í–‰ë™ê³¼ ì—°ë™

### 3. **zenohì˜ ì´ì¤‘ ì—­í• **
- **ì¼ë°˜ ë©”ì‹œì§€**: VSS ê²½ì°° ë°ì´í„° ë¼ìš°íŒ… (`police/*` í† í”½)
- **SHM (Shared Memory)**: ê³ ì„±ëŠ¥ ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ (67MB ìš©ëŸ‰)
- í•˜ë‚˜ì˜ zenoh ë¼ìš°í„°ê°€ ë‘ ê°€ì§€ í†µì‹  ë°©ì‹ì„ ë™ì‹œ ì§€ì›

### 4. **ì›¹ ì¸í„°í˜ì´ìŠ¤ í†µí•©ì **
- í¬íŠ¸ 8080: ì‹¤ì‹œê°„ ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ (CARLA ì¶œì²˜)
- í¬íŠ¸ 8081: VSS ê²½ì°° ë°ì´í„° (ì‹œë®¬ë ˆì´ì…˜ ì¶œì²˜)
- `police_dashboard_enhanced.html`ì—ì„œ ë‘ ìŠ¤íŠ¸ë¦¼ í†µí•© í‘œì‹œ

### í•µì‹¬ ì»´í¬ë„ŒíŠ¸ (Core Components)

#### 1. ë©”ì¸ ëŸ°ì²˜ (Main Launcher)
**íŒŒì¼**: `run_enhanced_police_system.py`
- **í´ë˜ìŠ¤**: `EnhancedPoliceSystemLauncher`
- **ì—­í• **: ì „ì²´ ì‹œìŠ¤í…œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë° í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬
- **ì£¼ìš” ê¸°ëŠ¥**:
  - ì˜ì¡´ì„± ê²€ì‚¬ (CARLA, ROS2, zenoh, Python íŒ¨í‚¤ì§€, C++ ë°”ì´ë„ˆë¦¬)
  - ìˆœì°¨ì  ì»´í¬ë„ŒíŠ¸ ì‹œì‘ (zenoh ë¼ìš°í„° â†’ CARLA ìŠ¤í°ë„ˆ â†’ VSS í¼ë¸”ë¦¬ì…” â†’ ë¸Œë¦¬ì§€ë“¤)
  - í”„ë¡œì„¸ìŠ¤ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ë° ì˜¤ë¥˜ ì²˜ë¦¬
  - graceful shutdown ì²˜ë¦¬

#### 2. VSS ë°ì´í„° í¼ë¸”ë¦¬ì…” (VSS Data Publisher)
**íŒŒì¼**: `police_vss_data_publisher.py`
- **í´ë˜ìŠ¤**: `PoliceVSSDataPublisher`
- **í‘œì¤€**: VSS (Vehicle Signal Specification) ì¤€ìˆ˜
- **ë°ì´í„° êµ¬ì¡°**:
  ```python
  {
    "Vehicle": {
      "VehicleIdentification": {...},
      "CurrentLocation": {...},
      "Police": {
        "Status": {...},
        "Emergency": {...},
        "Equipment": {...},
        "Officer": {...}
      },
      "Body": {...},
      "Powertrain": {...},
      "Service": {...},
      "OBD": {...}
    }
  }
  ```

#### 3. KUKSA-zenoh ë¸Œë¦¬ì§€ (KUKSA-zenoh Bridge)
**íŒŒì¼**: `kuksa_zenoh_bridge.py`
- **í´ë˜ìŠ¤**: `KuksaZenohBridge`
- **ê¸°ëŠ¥**:
  - VSS ë°ì´í„° ìœ íš¨ì„± ê²€ì¦ (JSON Schema ê¸°ë°˜)
  - ì‘ê¸‰ ìƒí™© ê°ì§€ ë° ì•Œë¦¼ ì‹œìŠ¤í…œ
  - ì‹¤ì‹œê°„ ë°ì´í„° ë³€í™˜ ë° ë¼ìš°íŒ…
  - ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë° í†µê³„

#### 4. ì›¹ì†Œì¼“ ë¸Œë¦¬ì§€ (WebSocket Bridge)
**íŒŒì¼**: `police_websocket_bridge.py`
- **í´ë˜ìŠ¤**: `PoliceWebSocketBridge`
- **í¬íŠ¸**: 8081 (ê²½ì°° VSS ë°ì´í„°)
- **ê¸°ëŠ¥**:
  - zenoh êµ¬ë… ë° WebSocket ë¸Œë¡œë“œìºìŠ¤íŠ¸
  - í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ê´€ë¦¬
  - ë©”ì‹œì§€ í ê¸°ë°˜ íš¨ìœ¨ì  ë¸Œë¡œë“œìºìŠ¤íŒ…
  - ì‘ê¸‰ ì•Œë¦¼ ìš°ì„  ì²˜ë¦¬

#### 5. CARLA ì°¨ëŸ‰ ìŠ¤í°ë„ˆ (CARLA Vehicle Spawner)
**íŒŒì¼**: `carla_vehicle_spawner.py`
- **í´ë˜ìŠ¤**: `CarlaVehicleSpawner`
- **ê¸°ëŠ¥**:
  - Tesla Model 3 ì°¨ëŸ‰ ìŠ¤í° (ê²½ì°° ì—­í• )
  - ì¹´ë©”ë¼ ë° LiDAR ì„¼ì„œ ì„¤ì •
  - ììœ¨ì£¼í–‰ í™œì„±í™”
  - ROS2 í† í”½ í¼ë¸”ë¦¬ì‹±

## ê¸°ìˆ ì  ìƒì„¸ (Technical Details)

### 1. í†µí•©ëœ ë°ì´í„° í”Œë¡œìš° (Integrated Data Flow)

**âœ… í†µí•©ëœ CARLA+VSS ì‹œìŠ¤í…œ**:

#### ì£¼ìš” ë°ì´í„° ê²½ë¡œ (Main Data Paths)
```
1. ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ê²½ë¡œ:
   CARLA â†’ carla_vehicle_spawner.py â†’ /carla/hero/camera/* â†’
   ros2_zenoh_shm_pub â†’ zenoh SHM â†’ zenoh_ws_shm_sub â†’ WebSocket(8080)

2. VSS ë°ì´í„° ê²½ë¡œ:
   CARLA â†’ carla_vehicle_spawner.py â†’ police/vss_data â†’
   kuksa_zenoh_bridge.py â†’ police/central/* â†’ police_websocket_bridge.py â†’ WebSocket(8081)

3. ì›¹ ëŒ€ì‹œë³´ë“œ í†µí•©:
   WebSocket(8080) + WebSocket(8081) â†’ police_dashboard_enhanced.html
```

**âœ… ì‹œìŠ¤í…œ í†µí•©ì˜ í•µì‹¬ íŠ¹ì§•**:
- **ë‹¨ì¼ ì†ŒìŠ¤ ì§„ì‹¤ì„±**: `carla_vehicle_spawner.py`ê°€ CARLAì™€ VSS ë°ì´í„°ë¥¼ ëª¨ë‘ ìƒì„±
- **ì™„ì „í•œ ë™ê¸°í™”**: ì°¨ëŸ‰ ìœ„ì¹˜, ì†ë„, ìƒíƒœê°€ ëª¨ë“  ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì—ì„œ ì¼ì¹˜
- **ì‹¤ì‹œê°„ ì—°ë™**: CARLA ì°¨ëŸ‰ í–‰ë™ì´ VSS ê²½ì°° ì‹œë‚˜ë¦¬ì˜¤ì— ì¦‰ì‹œ ë°˜ì˜
- **ì´ì¤‘ zenoh í™œìš©**: SHM(ì¹´ë©”ë¼)ê³¼ Messages(VSS) ë™ì‹œ ì§€ì›
- **ì›¹ í†µí•©**: ë‘ ë…ë¦½ì  ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì´ í•˜ë‚˜ì˜ ëŒ€ì‹œë³´ë“œì—ì„œ í†µí•© í‘œì‹œ

### 2. ë„¤íŠ¸ì›Œí¬ í”„ë¡œí† ì½œ (Network Protocols)

#### zenoh í† í”½ êµ¬ì¡° (zenoh Topic Structure)
```
police/{district}/vehicle/{unit_id}/vss        # VSS ë°ì´í„°
police/{district}/vehicle/{unit_id}/status     # ìƒíƒœ ë°ì´í„°
police/{district}/alerts/emergency/{unit_id}   # ì‘ê¸‰ ì•Œë¦¼
police/{district}/fleet/status                 # í•¨ëŒ€ ìƒíƒœ
police/{district}/bridge/heartbeat             # ë¸Œë¦¬ì§€ ìƒíƒœ
```

#### WebSocket ë©”ì‹œì§€ íƒ€ì… (WebSocket Message Types)
```javascript
{
  type: "vss_data" | "status" | "emergency_alert" | "fleet_status" | "heartbeat",
  unit_id: string,
  data: object,
  timestamp: number
}
```

### 3. VSS ìŠ¤í‚¤ë§ˆ ê²€ì¦ (VSS Schema Validation)

**íŒŒì¼**: `vss_police_schema.json`
- JSON Schema Draft-07 í‘œì¤€
- ê²½ì°°ì°¨ëŸ‰ íŠ¹í™” ë°ì´í„° êµ¬ì¡° ì •ì˜
- ì‹¤ì‹œê°„ ë°ì´í„° ìœ íš¨ì„± ê²€ì¦

### 4. C++ ê³ ì„±ëŠ¥ ì»´í¬ë„ŒíŠ¸ (High-Performance C++ Components)

#### ë¹Œë“œ ì‹œìŠ¤í…œ (Build System)
- **CMake**: `CMakeLists.txt`
- **Makefile**: ëŒ€ì•ˆ ë¹Œë“œ ì‹œìŠ¤í…œ
- **ì˜ì¡´ì„±**: ROS2 Humble, zenoh-c, Boost.Beast, nlohmann/json

#### ì»´íŒŒì¼ëœ ë°”ì´ë„ˆë¦¬ (Compiled Binaries)
```
build/ros2_zenoh_shm_pub     # ROS2 â†’ zenoh SHM í¼ë¸”ë¦¬ì…”
build/zenoh_ws_shm_sub       # zenoh SHM â†’ WebSocket êµ¬ë…ì
```

### 5. ì‘ê¸‰ ìƒí™© ì²˜ë¦¬ (Emergency Handling)

#### ì‘ê¸‰ ì‹œë‚˜ë¦¬ì˜¤ (Emergency Scenarios)
- **êµí†µ ë‹¨ì†** (traffic_stop): CODE1, ì‚¬ì´ë Œ OFF
- **ì¶”ê²©ì „** (pursuit): CODE3, ì‚¬ì´ë Œ ON, ê³ ì†
- **ê°€ì •í­ë ¥ ì‹ ê³ ** (domestic_call): CODE2, ì‚¬ì´ë Œ OFF
- **ì¼ë°˜ ìˆœì°°** (routine_patrol): ëª¨ë“  ê²½ê³ ë“± OFF

#### íŒ¨ë‹‰ ë²„íŠ¼ ì‹œìŠ¤í…œ (Panic Button System)
- 0.001% í™•ë¥ ë¡œ ì„ì˜ ë°œìƒ (ì‹œë®¬ë ˆì´ì…˜)
- ì¦‰ì‹œ CRITICAL ìš°ì„ ìˆœìœ„ ì•Œë¦¼ ë°œì†¡
- 5ì´ˆ í›„ ìë™ ë¦¬ì…‹

## ì„¤ì¹˜ ë° ì„¤ì • (Installation & Setup)

### ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ (System Requirements)

#### ì†Œí”„íŠ¸ì›¨ì–´ ì˜ì¡´ì„± (Software Dependencies)
```bash
# ROS2 Humble
source /opt/ros/humble/setup.bash

# Python íŒ¨í‚¤ì§€
pip install rclpy zenoh jsonschema websockets opencv-python

# ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€
sudo apt install nlohmann-json3-dev libboost-dev zenoh-c-dev

# CARLA ì‹œë®¬ë ˆì´í„°
# /opt/carla-simulator/ ë˜ëŠ” /home/seame/PythonAPI/
```

#### í•˜ë“œì›¨ì–´ ìš”êµ¬ì‚¬í•­ (Hardware Requirements)
- **CPU**: ìµœì†Œ 4ì½”ì–´ (ê¶Œì¥ 8ì½”ì–´)
- **RAM**: ìµœì†Œ 8GB (ê¶Œì¥ 16GB)
- **GPU**: NVIDIA GTX 1060 ì´ìƒ (CARLAìš©)
- **ë„¤íŠ¸ì›Œí¬**: ê¸°ê°€ë¹„íŠ¸ ì´ë”ë„·

### ë¹Œë“œ ê³¼ì • (Build Process)

#### C++ ì»´í¬ë„ŒíŠ¸ ë¹Œë“œ
```bash
# CMAKE ë°©ì‹
mkdir -p build && cd build
cmake ..
make -j$(nproc)

# Makefile ë°©ì‹
make all
```

#### ì„¤ì • íŒŒì¼ (Configuration Files)
```json
// config/police_system_config.json (ì„ íƒì )
{
  "camera_shm_capacity": 67108864,
  "police_district": "central",
  "enable_vss_validation": true,
  "enable_emergency_alerts": true,
  "carla_host": "localhost",
  "carla_port": 2000,
  "police_units": [...],
  "dashboard_auto_open": true,
  "log_level": "INFO"
}
```

## ì‹¤í–‰ ë°©ë²• (Execution)

### ì „ì²´ ì‹œìŠ¤í…œ ì‹œì‘ (Full System Startup)
```bash
python3 run_enhanced_police_system.py
```

### ê°œë³„ ì»´í¬ë„ŒíŠ¸ ì‹¤í–‰ (Individual Component Execution)
```bash
# VSS ë°ì´í„° í¼ë¸”ë¦¬ì…”
python3 police_vss_data_publisher.py

# KUKSA-zenoh ë¸Œë¦¬ì§€
python3 kuksa_zenoh_bridge.py

# ì›¹ì†Œì¼“ ë¸Œë¦¬ì§€
python3 police_websocket_bridge.py --port 8081 --district central

# CARLA ì°¨ëŸ‰ ìŠ¤í°ë„ˆ
python3 carla_vehicle_spawner.py

# C++ SHM í¼ë¸”ë¦¬ì…”
./build/ros2_zenoh_shm_pub --capacity 67108864

# C++ ì›¹ì†Œì¼“ êµ¬ë…ì
./build/zenoh_ws_shm_sub --port 8080
```

### ì‹œìŠ¤í…œ ì¢…ë£Œ (System Shutdown)
- `Ctrl+C`ë¡œ graceful shutdown
- ëª¨ë“  í”„ë¡œì„¸ìŠ¤ ìë™ ì •ë¦¬
- CARLA ì•¡í„° ì‚­ì œ

## ëª¨ë‹ˆí„°ë§ ë° ë””ë²„ê¹… (Monitoring & Debugging)

### ë¡œê·¸ ì‹œìŠ¤í…œ (Logging System)
```python
# ë¡œê·¸ ë ˆë²¨: DEBUG, INFO, WARNING, ERROR
# íŒŒì¼ ì¶œë ¥: enhanced_police_system_{timestamp}.log
# ì½˜ì†” ì¶œë ¥: ì‹¤ì‹œê°„ ìƒíƒœ í‘œì‹œ
```

### ì„±ëŠ¥ ì§€í‘œ (Performance Metrics)
```python
{
  "messages_received": int,
  "messages_published": int,
  "validation_errors": int,
  "emergency_alerts": int,
  "uptime_seconds": float,
  "active_units_count": int
}
```

### API ì—”ë“œí¬ì¸íŠ¸ (API Endpoints)
```
ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼:    ws://localhost:8080
ê²½ì°° VSS ë°ì´í„°:  ws://localhost:8081
ëŒ€ì‹œë³´ë“œ:        file://police_dashboard_enhanced.html
```

## í™•ì¥ì„± (Extensibility)

### ìƒˆë¡œìš´ ì„¼ì„œ ì¶”ê°€ (Adding New Sensors)
1. CARLA ì„¼ì„œ ì •ì˜ (`carla_vehicle_spawner.py`)
2. VSS ìŠ¤í‚¤ë§ˆ í™•ì¥ (`vss_police_schema.json`)
3. ë°ì´í„° í¼ë¸”ë¦¬ì…” ì—…ë°ì´íŠ¸ (`police_vss_data_publisher.py`)

### ë‹¤ì¤‘ ì§€ì—­ ì§€ì› (Multi-District Support)
```python
# ì§€ì—­ë³„ zenoh í† í”½ ë¶„ë¦¬
f"police/{district}/vehicle/{unit_id}/..."
```

### ì‚¬ìš©ì ì •ì˜ ì‹œë‚˜ë¦¬ì˜¤ (Custom Scenarios)
```python
# emergency_scenarios ë°°ì—´ì— ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ ì¶”ê°€
{
  "name": "custom_scenario",
  "duration": 300,
  "lightbar": "CUSTOM",
  "siren": True,
  "availability": "BUSY",
  "call_type": "CUSTOM CALL",
  "priority": "MEDIUM"
}
```

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­ (Security Considerations)

### ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ (Network Security)
- zenoh ë¼ìš°í„° ì¸ì¦ ì„¤ì • ê¶Œì¥
- WebSocket ì—°ê²° HTTPS/WSS ì—…ê·¸ë ˆì´ë“œ
- ë°©í™”ë²½ í¬íŠ¸ ì œí•œ (8080, 8081)

### ë°ì´í„° ê²€ì¦ (Data Validation)
- JSON Schema ê¸°ë°˜ VSS ê²€ì¦
- ì…ë ¥ ë°ì´í„° ì‚´ê·  (sanitization)
- ì˜¤ë¥˜ ì²˜ë¦¬ ë° ë¡œê¹…

## ë¬¸ì œ í•´ê²° (Troubleshooting)

### ì¼ë°˜ì ì¸ ë¬¸ì œ (Common Issues)

#### CARLA ì—°ê²° ì‹¤íŒ¨
```bash
# CARLA ì„œë²„ ìƒíƒœ í™•ì¸
netstat -tlnp | grep :2000

# CARLA ì¬ì‹œì‘
cd /opt/carla-simulator && ./CarlaUE4.sh
```

#### zenoh ë¼ìš°í„° ë¬¸ì œ
```bash
# zenoh í”„ë¡œì„¸ìŠ¤ í™•ì¸
pgrep -f zenohd

# ìˆ˜ë™ ë¼ìš°í„° ì‹œì‘
zenohd --cfg 'transport: {shared_memory: {enabled: true}}'
```

#### ë¹Œë“œ ì˜¤ë¥˜
```bash
# ì˜ì¡´ì„± ì¬ì„¤ì¹˜
sudo apt update && sudo apt install -y nlohmann-json3-dev libboost-dev

# ë¹Œë“œ ë””ë ‰í† ë¦¬ í´ë¦°
rm -rf build && mkdir build
```

### ì„±ëŠ¥ ìµœì í™” (Performance Optimization)

#### SHM ìš©ëŸ‰ ì¡°ì • (SHM Capacity Tuning)
```bash
# ê¸°ë³¸ê°’: 64MB
./ros2_zenoh_shm_pub --capacity 134217728  # 128MB
```

#### CPU ì¹œí™”ì„± ì„¤ì • (CPU Affinity)
```bash
# íŠ¹ì • CPU ì½”ì–´ì— ë°”ì¸ë”©
taskset -c 0-3 python3 run_enhanced_police_system.py
```

## ë¼ì´ì„ ìŠ¤ ë° ê¸°ì—¬ (License & Contributing)

### ë¼ì´ì„ ìŠ¤ (License)
- **í”„ë¡œì íŠ¸**: MIT License
- **zenoh**: Apache 2.0 / Eclipse Public License 2.0
- **ROS2**: Apache 2.0
- **CARLA**: MIT License

### ê¸°ì—¬ ë°©ë²• (Contributing)
1. ì´ìŠˆ ìƒì„± ë° ë…¼ì˜
2. í¬í¬ ë° ë¸Œëœì¹˜ ìƒì„±
3. í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±
4. í’€ ë¦¬í€˜ìŠ¤íŠ¸ ì œì¶œ

---

## ê²°ë¡  (Conclusion)

ì´ **Enhanced Police Monitoring System**ì€ ìµœì‹  ììœ¨ì£¼í–‰ ì‹œë®¬ë ˆì´ì…˜, ë¡œë´‡ê³µí•™, í†µì‹  ê¸°ìˆ ì„ í†µí•©í•˜ì—¬ ì‹¤ì‹œê°„ ê²½ì°°ì°¨ëŸ‰ ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ ì™„ì „í•œ ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.

### í•µì‹¬ ì•„í‚¤í…ì²˜ í˜ì‹ ì 

1. **ë¶„ë¦¬ëœ ë°ì´í„° í”Œë¡œìš° ì„¤ê³„**: CARLA ë¬¼ë¦¬ ì‹œë®¬ë ˆì´ì…˜ê³¼ VSS ê²½ì°° ì—…ë¬´ ë°ì´í„°ë¥¼ ì™„ì „íˆ ë¶„ë¦¬í•˜ì—¬ ê°ê° ìµœì í™”
2. **ì´ì¤‘ zenoh í™œìš©**: SHM(ê³ ì„±ëŠ¥ ì¹´ë©”ë¼)ì™€ ì¼ë°˜ ë©”ì‹œì§€(VSS ë°ì´í„°)ë¥¼ ë™ì‹œ ì§€ì›
3. **ì›¹ í†µí•© ì•„í‚¤í…ì²˜**: ë…ë¦½ì ì¸ ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì„ ì›¹ ëŒ€ì‹œë³´ë“œì—ì„œ ì‹¤ì‹œê°„ í†µí•©

### ê¸°ìˆ ì  ì™„ì„±ë„

- **VSS í‘œì¤€ ì¤€ìˆ˜**: í‘œì¤€í™”ëœ ê²½ì°°ì°¨ëŸ‰ ë°ì´í„° êµ¬ì¡°
- **ê³ ì„±ëŠ¥ C++ ì»´í¬ë„ŒíŠ¸**: 67MB SHM ìš©ëŸ‰ì˜ ì‹¤ì‹œê°„ ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¬ë°
- **í™•ì¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜**: ë©€í‹° ì§€ì—­, ë‹¤ì¤‘ ì„¼ì„œ ì§€ì› ê°€ëŠ¥
- **ê²¬ê³ í•œ í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬**: graceful shutdown, ì˜¤ë¥˜ ë³µêµ¬, ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

ì‹œìŠ¤í…œì˜ í•µì‹¬ì¸ `run_enhanced_police_system.py`ëŠ” **3ê°œì˜ ë…ë¦½ì ì¸ ë°ì´í„° í”Œë¡œìš°**ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜í•˜ë©°, ê° ì»´í¬ë„ŒíŠ¸ì˜ ê³ ìœ í•œ ì—­í• ì„ ë³´ì¥í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë¶„ë¦¬ëœ ì„¤ê³„ëŠ” ì—°êµ¬, êµìœ¡, ê·¸ë¦¬ê³  ìƒìš© ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë“  ì˜ì—­ì—ì„œ ìœ ì—°í•˜ê²Œ í™œìš© ê°€ëŠ¥í•œ ê²¬ê³ í•œ í”Œë«í¼ì„ ì œê³µí•©ë‹ˆë‹¤.