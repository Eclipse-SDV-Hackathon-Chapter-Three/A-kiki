# Ankaios ìƒì„¸ ê°€ì´ë“œ (Detailed Guide)

Eclipse Ankaiosë¥¼ ì‚¬ìš©í•œ Enhanced Police Monitoring Systemì˜ ì™„ë²½í•œ ì´í•´ë¥¼ ìœ„í•œ ìƒì„¸ ê°€ì´ë“œì…ë‹ˆë‹¤.

---

## ğŸ“š ëª©ì°¨

1. [Ankaiosë€ ë¬´ì—‡ì¸ê°€?](#1-ankaiosë€-ë¬´ì—‡ì¸ê°€)
2. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#2-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
3. [ì‘ë™ ì›ë¦¬](#3-ì‘ë™-ì›ë¦¬)
4. [ì›Œí¬ë¡œë“œ ìƒëª…ì£¼ê¸°](#4-ì›Œí¬ë¡œë“œ-ìƒëª…ì£¼ê¸°)
5. [ì˜ì¡´ì„± ê´€ë¦¬](#5-ì˜ì¡´ì„±-ê´€ë¦¬)
6. [ì¬ì‹œì‘ ì •ì±…](#6-ì¬ì‹œì‘-ì •ì±…)
7. [í†µì‹  í”„ë¡œí† ì½œ](#7-í†µì‹ -í”„ë¡œí† ì½œ)
8. [ì‹¤ì „ ì‹œë‚˜ë¦¬ì˜¤](#8-ì‹¤ì „-ì‹œë‚˜ë¦¬ì˜¤)
9. [ë¬¸ì œ í•´ê²°](#9-ë¬¸ì œ-í•´ê²°)
10. [ê³ ê¸‰ í™œìš©](#10-ê³ ê¸‰-í™œìš©)

---

## 1. Ankaiosë€ ë¬´ì—‡ì¸ê°€?

### 1.1 ê°œìš”

**Eclipse Ankaios**ëŠ” ìë™ì°¨ ì‚°ì—…ì„ ìœ„í•´ íŠ¹ë³„íˆ ì„¤ê³„ëœ **ì›Œí¬ë¡œë“œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í”Œë«í¼**ì…ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kubernetes (ì¿ ë²„ë„¤í‹°ìŠ¤)                    â”‚
â”‚  - í´ë¼ìš°ë“œ/ë°ì´í„°ì„¼í„°ìš©                     â”‚
â”‚  - ë¬´ê²ê³  ë³µì¡í•¨                            â”‚
â”‚  - ìë™ì°¨ì—ëŠ” ê³¼ë„í•œ ê¸°ëŠ¥                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  vs
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Eclipse Ankaios (ì•ˆì¹´ì´ì˜¤ìŠ¤)               â”‚
â”‚  - ìë™ì°¨ HPC í”Œë«í¼ìš©                      â”‚
â”‚  - ê°€ë³ê³  íš¨ìœ¨ì                             â”‚
â”‚  - ìë™ì°¨ì— ìµœì í™”                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ì™œ Ankaiosë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€?

#### ì „í†µì ì¸ ë°©ì‹ (`run_enhanced_police_system.py`)

```python
# Python ìŠ¤í¬ë¦½íŠ¸ë¡œ ì§ì ‘ í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬
import subprocess

# ê° í”„ë¡œì„¸ìŠ¤ë¥¼ subprocessë¡œ ì‹œì‘
zenoh_process = subprocess.Popen(['zenohd'])
carla_process = subprocess.Popen(['python3', 'carla_spawner.py'])
# ... ë” ë§ì€ í”„ë¡œì„¸ìŠ¤ë“¤

# ë¬¸ì œì :
# 1. í”„ë¡œì„¸ìŠ¤ê°€ ì£½ìœ¼ë©´? â†’ ìˆ˜ë™ìœ¼ë¡œ ì¬ì‹œì‘
# 2. ì˜ì¡´ì„± ê´€ë¦¬? â†’ sleep()ìœ¼ë¡œ ì‹œê°„ ëŒ€ê¸°
# 3. ì—¬ëŸ¬ ì»´í“¨í„°ì—ì„œ ì‹¤í–‰? â†’ ë¶ˆê°€ëŠ¥
# 4. í”„ë¡œì„¸ìŠ¤ ê²©ë¦¬? â†’ ì—†ìŒ (ê°™ì€ ì‹œìŠ¤í…œ ê³µìœ )
```

#### Ankaios ë°©ì‹

```yaml
# YAML íŒŒì¼ë¡œ ì„ ì–¸ì  ê´€ë¦¬
workloads:
  zenoh-router:
    restartPolicy: ALWAYS  # ìë™ ì¬ì‹œì‘
    dependencies: {}       # ì˜ì¡´ì„± ëª…ì‹œ

  carla-spawner:
    restartPolicy: ON_FAILURE
    dependencies:
      zenoh-router: ADD_COND_RUNNING  # ìë™ ìˆœì„œ ê´€ë¦¬

# ì¥ì :
# 1. ìë™ ì¬ì‹œì‘
# 2. ì˜ì¡´ì„± ê¸°ë°˜ ìë™ ì‹œì‘
# 3. ë‹¤ì¤‘ ë…¸ë“œ ì§€ì›
# 4. ì»¨í…Œì´ë„ˆ ê²©ë¦¬
```

### 1.3 í•µì‹¬ ê°œë…

**ì›Œí¬ë¡œë“œ (Workload)**
```
ì›Œí¬ë¡œë“œ = ì‹¤í–‰í•˜ê³  ì‹¶ì€ í”„ë¡œê·¸ë¨/ì„œë¹„ìŠ¤

ì˜ˆì‹œ:
- zenoh-router (í†µì‹  ë¯¸ë“¤ì›¨ì–´)
- carla-spawner (ì°¨ëŸ‰ ì‹œë®¬ë ˆì´í„°)
- kuksa-bridge (ë°ì´í„° ë¸Œë¦¿ì§€)
```

**ì»¨í…Œì´ë„ˆ (Container)**
```
ì»¨í…Œì´ë„ˆ = í”„ë¡œê·¸ë¨ + ëª¨ë“  ì˜ì¡´ì„±ì„ í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ë¡œ

ë§ˆì¹˜ ë„ì‹œë½ì²˜ëŸ¼:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Python í”„ë¡œê·¸ë¨      â”‚
â”‚ + Python ëŸ°íƒ€ì„     â”‚
â”‚ + í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬  â”‚
â”‚ + ì„¤ì • íŒŒì¼         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†’ ì–´ë””ì„œë‚˜ ë™ì¼í•˜ê²Œ ì‹¤í–‰
```

**ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ (Orchestration)**
```
ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ = ì—¬ëŸ¬ í”„ë¡œê·¸ë¨ì„ ì¡°ìœ¨í•˜ì—¬ ê´€ë¦¬

ë§ˆì¹˜ êµí–¥ì•…ë‹¨ì˜ ì§€íœ˜ìì²˜ëŸ¼:
- ëˆ„ê°€ ë¨¼ì € ì‹œì‘í•˜ê³ 
- ëˆ„ê°€ ì˜ì¡´í•˜ëŠ”ì§€
- ì£½ìœ¼ë©´ ì–´ë–»ê²Œ í• ì§€
â†’ ìë™ìœ¼ë¡œ ê´€ë¦¬
```

---

## 2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 2.1 ì „ì²´ êµ¬ì¡°ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ’» ì‚¬ìš©ì (User)                          â”‚
â”‚                                                              â”‚
â”‚  ank -k apply manifest.yaml  â† CLI ëª…ë ¹ì–´                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                    HTTP/gRPC
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ğŸ§  Ankaios Server                            â”‚
â”‚                 (ì¤‘ì•™ ì œì–´ ì‹œìŠ¤í…œ)                            â”‚
â”‚                                                              â”‚
â”‚  ì—­í• :                                                       â”‚
â”‚  - Manifest íŒŒì‹± ë° í•´ì„                                     â”‚
â”‚  - ì›Œí¬ë¡œë“œ ìƒíƒœ ì¶”ì                                          â”‚
â”‚  - ì˜ì¡´ì„± ê·¸ë˜í”„ ê´€ë¦¬                                         â”‚
â”‚  - Agentì—ê²Œ ëª…ë ¹ ì „ë‹¬                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                    gRPC í†µì‹ 
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Agent #1    â”‚         â”‚  ğŸ¤– Agent #2     â”‚
â”‚  (police_agent) â”‚         â”‚  (backup_agent)  â”‚
â”‚                 â”‚         â”‚                  â”‚
â”‚  Node 1         â”‚         â”‚  Node 2          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                             â”‚
   Podman API                    Podman API
        â”‚                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ³ Podman      â”‚         â”‚  ğŸ³ Podman       â”‚
â”‚  (ì»¨í…Œì´ë„ˆ ì‹¤í–‰) â”‚         â”‚  (ì»¨í…Œì´ë„ˆ ì‹¤í–‰)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                             â”‚
  â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
  â”‚     â”‚     â”‚     â”‚          â”‚      â”‚      â”‚
[ğŸ“¦C1] [ğŸ“¦C2] [ğŸ“¦C3] [ğŸ“¦C4]    [ğŸ“¦C5] [ğŸ“¦C6]
zenoh  carla kuksa camera    backup backup
```

### 2.2 ê° ì»´í¬ë„ŒíŠ¸ ìƒì„¸ ì„¤ëª…

#### 2.2.1 Ankaios Server (ì„œë²„)

**ì—­í• **: ì‹œìŠ¤í…œì˜ ë‘ë‡Œ (Brain)

```
ì…ë ¥: ankaios_manifest.yaml
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Manifest íŒŒì‹±            â”‚
â”‚     - YAML ì½ê¸°              â”‚
â”‚     - ì›Œí¬ë¡œë“œ ì •ì˜ ì¶”ì¶œ      â”‚
â”‚     - ì˜ì¡´ì„± ê·¸ë˜í”„ ìƒì„±      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. ìƒíƒœ ê´€ë¦¬                â”‚
â”‚     - ê° ì›Œí¬ë¡œë“œ ìƒíƒœ ì¶”ì    â”‚
â”‚     - Agent ìƒíƒœ ëª¨ë‹ˆí„°ë§    â”‚
â”‚     - ì˜ì¡´ì„± ì¶©ì¡± ì—¬ë¶€ í™•ì¸   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. ê²°ì • ë° ëª…ë ¹             â”‚
â”‚     - ì‹œì‘ ìˆœì„œ ê²°ì •         â”‚
â”‚     - Agentì— ëª…ë ¹ ì „ë‹¬      â”‚
â”‚     - ì¬ì‹œì‘ ê²°ì •            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
ì¶œë ¥: Agentì—ê²Œ gRPC ëª…ë ¹
```

**ì‹¤í–‰ ë°©ë²•**:
```bash
# í¬ê·¸ë¼ìš´ë“œ ì‹¤í–‰ (ë””ë²„ê¹…ìš©)
ank-server

# ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
ank-server &

# ë¡œê·¸ í™•ì¸
tail -f /tmp/ankaios-server.log
```

**í¬íŠ¸ ë° í†µì‹ **:
```
ê¸°ë³¸ í¬íŠ¸: 25551 (gRPC)
í†µì‹  ë°©ì‹: gRPC with Protobuf
ë³´ì•ˆ: TLS ì˜µì…˜ ì§€ì› (ì„ íƒì )
```

#### 2.2.2 Ankaios Agent (ì—ì´ì „íŠ¸)

**ì—­í• **: ì‹¤ì œ ì¼ê¾¼ (Worker)

```
Serverë¡œë¶€í„° ëª…ë ¹ ìˆ˜ì‹ 
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ëª…ë ¹ ì²˜ë¦¬                â”‚
â”‚     - "zenoh-router ì‹œì‘"    â”‚
â”‚     - "carla-spawner ì¬ì‹œì‘" â”‚
â”‚     - "ìƒíƒœ ë³´ê³ "            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. Podman ì œì–´             â”‚
â”‚     - ì»¨í…Œì´ë„ˆ ìƒì„±          â”‚
â”‚     - ì»¨í…Œì´ë„ˆ ì‹œì‘/ì¤‘ì§€     â”‚
â”‚     - ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. ìƒíƒœ ë³´ê³                â”‚
â”‚     - ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸     â”‚
â”‚     - ì—ëŸ¬ ë°œìƒ ì‹œ ë³´ê³       â”‚
â”‚     - ì£¼ê¸°ì  ìƒíƒœ ì—…ë°ì´íŠ¸   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
Podmanì„ í†µí•´ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
```

**ì‹¤í–‰ ë°©ë²•**:
```bash
# ì—ì´ì „íŠ¸ ì‹œì‘ (ì´ë¦„ ì§€ì • í•„ìˆ˜)
ank-agent --name police_agent

# ì—¬ëŸ¬ ë…¸ë“œì—ì„œ ì‹¤í–‰ ê°€ëŠ¥
# Node 1:
ank-agent --name node1_agent

# Node 2:
ank-agent --name node2_agent

# ë¡œê·¸ í™•ì¸
tail -f /tmp/ankaios-agent.log
```

**ì„¤ì • ì˜ˆì‹œ**:
```yaml
# manifestì—ì„œ Agent ì§€ì •
workloads:
  zenoh-router:
    agent: police_agent  # â† ì´ Agentì—ì„œ ì‹¤í–‰

  backup-service:
    agent: backup_agent  # â† ë‹¤ë¥¸ Agentì—ì„œ ì‹¤í–‰
```

#### 2.2.3 Podman Runtime

**ì—­í• **: ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì—”ì§„

```
Agentë¡œë¶€í„° ëª…ë ¹
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Podman Engine              â”‚
â”‚                             â”‚
â”‚  podman run                 â”‚
â”‚    --network host           â”‚
â”‚    --name zenoh-router      â”‚
â”‚    eclipse/zenoh:latest     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì»¨í…Œì´ë„ˆ ìƒì„± ë° ì‹¤í–‰       â”‚
â”‚  - ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ           â”‚
â”‚  - ë„¤íŠ¸ì›Œí¬ ì„¤ì •             â”‚
â”‚  - ë³¼ë¥¨ ë§ˆìš´íŠ¸              â”‚
â”‚  - í”„ë¡œì„¸ìŠ¤ ì‹œì‘             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ
```

**Podman vs Docker**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker                                 â”‚
â”‚  - ë°ëª¬ í•„ìš” (dockerd)                   â”‚
â”‚  - root ê¶Œí•œ í•„ìš”                        â”‚
â”‚  - ë‹¨ì¼ ì¥ì• ì                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              vs
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Podman                                 â”‚
â”‚  - ë°ëª¬ ë¶ˆí•„ìš” (daemonless)              â”‚
â”‚  - rootless ì§€ì›                        â”‚
â”‚  - ë” ì•ˆì „í•¨                            â”‚
â”‚  - Kubernetes-compatible                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ì‘ë™ ì›ë¦¬

### 3.1 ì‹œìŠ¤í…œ ì‹œì‘ ê³¼ì • (Step-by-Step)

#### Step 1: ì‚¬ìš©ìê°€ `./start_ankaios.sh` ì‹¤í–‰

```bash
#!/bin/bash
# start_ankaios.sh ë‚´ë¶€

# 1. Prerequisites ì²´í¬
check_carla_running()
check_images_exist()
check_ankaios_installed()

# 2. Ankaios Server ì‹œì‘
ank-server &
# â†’ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰
# â†’ í¬íŠ¸ 25551ì—ì„œ ëŒ€ê¸°

# 3. Ankaios Agent ì‹œì‘
ank-agent --name police_agent &
# â†’ Serverì— ìë™ ì—°ê²°
# â†’ Podmanê³¼ í†µì‹  ì¤€ë¹„

# 4. Manifest ì ìš©
ank -k apply ankaios_manifest.yaml
# â†’ ì—¬ê¸°ì„œ ë§ˆë²•ì´ ì‹œì‘ë©ë‹ˆë‹¤!
```

#### Step 2: Serverê°€ Manifest íŒŒì‹±

```yaml
# ankaios_manifest.yaml
apiVersion: v0.1
workloads:
  zenoh-router:
    runtime: podman
    agent: police_agent
    restartPolicy: ALWAYS
    dependencies: {}
    runtimeConfig: |
      image: eclipse/zenoh:latest
      commandOptions: ["--network", "host"]
```

**Server ë‚´ë¶€ ì²˜ë¦¬**:
```
1. YAML íŒŒì‹±
   â””â”€ apiVersion í™•ì¸: v0.1 âœ“
   â””â”€ workloads ì„¹ì…˜ íŒŒì‹±

2. ê° ì›Œí¬ë¡œë“œ ë¶„ì„
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ zenoh-router                â”‚
   â”‚  - runtime: podman          â”‚
   â”‚  - agent: police_agent      â”‚
   â”‚  - restartPolicy: ALWAYS    â”‚
   â”‚  - dependencies: (ì—†ìŒ)     â”‚
   â”‚  - runtimeConfig: ì´ë¯¸ì§€ì •ë³´ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. ì˜ì¡´ì„± ê·¸ë˜í”„ ìƒì„±
   zenoh-router (ì˜ì¡´ì„± ì—†ìŒ, ë¨¼ì € ì‹œì‘)
       â†“
   carla-spawner (zenoh-router í•„ìš”)
       â†“
   â”œâ”€ kuksa-bridge (zenoh + carla í•„ìš”)
   â””â”€ camera-bridge (zenoh + carla í•„ìš”)
       â†“
   â”œâ”€ camera-websocket
   â””â”€ police-websocket

4. ì‹œì‘ ìˆœì„œ ê²°ì •
   ìš°ì„ ìˆœìœ„ í ìƒì„±:
   [1] zenoh-router
   [2] carla-spawner
   [3] kuksa-bridge, camera-bridge (ë³‘ë ¬)
   [4] camera-websocket, police-websocket (ë³‘ë ¬)
```

#### Step 3: Agentì—ê²Œ ëª…ë ¹ ì „ë‹¬

**gRPC í†µì‹  ì˜ˆì‹œ**:
```protobuf
// Server â†’ Agent
message StartWorkloadRequest {
  workload_name: "zenoh-router"
  agent_name: "police_agent"
  runtime: "podman"
  runtime_config: {
    image: "eclipse/zenoh:latest"
    command_options: ["--network", "host"]
  }
}
```

**Agent ë‚´ë¶€ ì²˜ë¦¬**:
```
1. ëª…ë ¹ ìˆ˜ì‹ 
   â””â”€ "zenoh-routerë¥¼ ì‹œì‘í•˜ì„¸ìš”"

2. Podman API í˜¸ì¶œ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ podman run                       â”‚
   â”‚   --network host                 â”‚
   â”‚   --name zenoh-router            â”‚
   â”‚   --restart always               â”‚
   â”‚   eclipse/zenoh:latest           â”‚
   â”‚   --cfg "transport:..."          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. ê²°ê³¼ í™•ì¸
   - ì»¨í…Œì´ë„ˆ ID: abc123def456
   - ìƒíƒœ: Running
   - í¬íŠ¸: (host network ì‚¬ìš©)

4. Serverì— ë³´ê³ 
   â””â”€ "zenoh-routerê°€ ì„±ê³µì ìœ¼ë¡œ ì‹œì‘ë¨"
```

#### Step 4: ìƒíƒœ ì¶”ì  ë° ë‹¤ìŒ ì›Œí¬ë¡œë“œ ì‹œì‘

```
Server ìƒíƒœ í…Œì´ë¸”:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Workload         â”‚ State       â”‚ Containerâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ zenoh-router     â”‚ Running âœ“   â”‚ abc123   â”‚
â”‚ carla-spawner    â”‚ Pending     â”‚ -        â”‚
â”‚ kuksa-bridge     â”‚ Pending     â”‚ -        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì˜ì¡´ì„± í™•ì¸:
carla-spawnerì˜ dependencies:
  â””â”€ zenoh-router: ADD_COND_RUNNING
  â””â”€ ìƒíƒœ: Running âœ“
  â””â”€ â†’ ì‹œì‘ ê°€ëŠ¥!

Server â†’ Agent:
  "carla-spawnerë¥¼ ì‹œì‘í•˜ì„¸ìš”"

ì—…ë°ì´íŠ¸ëœ ìƒíƒœ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Workload         â”‚ State       â”‚ Containerâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ zenoh-router     â”‚ Running âœ“   â”‚ abc123   â”‚
â”‚ carla-spawner    â”‚ Running âœ“   â”‚ def456   â”‚
â”‚ kuksa-bridge     â”‚ Pending     â”‚ -        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì´ ê³¼ì •ì„ ëª¨ë“  ì›Œí¬ë¡œë“œê°€ ì‹œì‘ë  ë•Œê¹Œì§€ ë°˜ë³µ...
```

### 3.2 ì‹¤ì‹œê°„ ìƒíƒœ ë™ê¸°í™”

**ì£¼ê¸°ì  ìƒíƒœ ì—…ë°ì´íŠ¸**:
```
Agent â†’ Server (10ì´ˆë§ˆë‹¤)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Heartbeat + Status Report          â”‚
â”‚                                    â”‚
â”‚ {                                  â”‚
â”‚   "agent": "police_agent",         â”‚
â”‚   "workloads": [                   â”‚
â”‚     {                              â”‚
â”‚       "name": "zenoh-router",      â”‚
â”‚       "state": "Running",          â”‚
â”‚       "container_id": "abc123",    â”‚
â”‚       "cpu": "5%",                 â”‚
â”‚       "memory": "120MB"            â”‚
â”‚     },                             â”‚
â”‚     ...                            â”‚
â”‚   ]                                â”‚
â”‚ }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ì›Œí¬ë¡œë“œ ìƒëª…ì£¼ê¸°

### 4.1 ì›Œí¬ë¡œë“œ ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨

```
                    ank apply
                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Pending      â”‚ â† ì‹œì‘ ëŒ€ê¸° ì¤‘
              â”‚  (ëŒ€ê¸° ìƒíƒœ)    â”‚   (ì˜ì¡´ì„± ë¯¸ì¶©ì¡±)
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ ì˜ì¡´ì„± ì¶©ì¡±
                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Starting     â”‚ â† Podman ì»¨í…Œì´ë„ˆ ìƒì„± ì¤‘
              â”‚  (ì‹œì‘ ì¤‘)     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Running      â”‚ â† ì •ìƒ ì‹¤í–‰ ì¤‘
              â”‚  (ì‹¤í–‰ ì¤‘) âœ“   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚             â”‚             â”‚
    ì •ìƒ ì¢…ë£Œ      ë¹„ì •ìƒ ì¢…ë£Œ    ì‚¬ìš©ì ëª…ë ¹
         â”‚             â”‚             â”‚
         â†“             â†“             â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Succeeded â”‚  â”‚  Failed  â”‚  â”‚ Stopping â”‚
  â”‚(ì„±ê³µ ì™„ë£Œ)â”‚  â”‚ (ì‹¤íŒ¨)   â”‚  â”‚(ì¤‘ì§€ ì¤‘) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                      â”‚             â”‚
                ì¬ì‹œì‘ ì •ì±…          â”‚
                  í™•ì¸              â”‚
                      â”‚             â†“
                      â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â””â”€â”€â”€â”€â”€â”€â†’â”‚ Stopped  â”‚
                              â”‚ (ì¤‘ì§€ë¨) â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ê° ìƒíƒœ ìƒì„¸ ì„¤ëª…

#### ğŸ“ Pending (ëŒ€ê¸°)

```
ìƒí™©: ì›Œí¬ë¡œë“œê°€ ì •ì˜ë˜ì—ˆì§€ë§Œ ì•„ì§ ì‹œì‘ ì•ˆë¨

ì´ìœ :
1. ì˜ì¡´ì„± ë¯¸ì¶©ì¡±
   ì˜ˆ: carla-spawnerê°€ zenoh-routerë¥¼ ê¸°ë‹¤ë¦¼

2. Agent ì—†ìŒ
   ì˜ˆ: ì§€ì •ëœ Agentê°€ ì•„ì§ ì—°ê²° ì•ˆë¨

3. ë¦¬ì†ŒìŠ¤ ë¶€ì¡±
   ì˜ˆ: ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•´ì„œ ëŒ€ê¸°

í™•ì¸ ë°©ë²•:
$ ank -k get workload kuksa-bridge
Name: kuksa-bridge
State: Pending
Reason: Waiting for dependency 'zenoh-router' to be Running
```

#### ğŸš€ Starting (ì‹œì‘ ì¤‘)

```
ìƒí™©: Podmanì´ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ê³  ì‹œì‘í•˜ëŠ” ì¤‘

ì§„í–‰ ê³¼ì •:
1. ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ (í•„ìš”ì‹œ)
   â””â”€ docker.io/library/ros:humble ë‹¤ìš´ë¡œë“œ ì¤‘...

2. ì»¨í…Œì´ë„ˆ ìƒì„±
   â””â”€ podman create --name kuksa-bridge ...

3. ë³¼ë¥¨ ë§ˆìš´íŠ¸
   â””â”€ -v /workspace:/workspace:Z

4. ë„¤íŠ¸ì›Œí¬ ì„¤ì •
   â””â”€ --network host

5. í”„ë¡œì„¸ìŠ¤ ì‹œì‘
   â””â”€ python3 /workspace/kuksa_zenoh_bridge.py

ì¼ë°˜ì ì¸ ì‹œê°„: 1-5ì´ˆ
ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ í•„ìš”ì‹œ: 30ì´ˆ-5ë¶„
```

#### âœ… Running (ì‹¤í–‰ ì¤‘)

```
ìƒí™©: ì»¨í…Œì´ë„ˆê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ ì¤‘

ê±´ê°• ìƒíƒœ ì²´í¬:
1. í”„ë¡œì„¸ìŠ¤ ì‚´ì•„ìˆìŒ
   â””â”€ PID ì¡´ì¬ í™•ì¸

2. Health Check í†µê³¼ (ì„¤ì •ëœ ê²½ìš°)
   â””â”€ ros2 node list | grep kuksa_zenoh_bridge

3. í¬íŠ¸ ë¦¬ìŠ¤ë‹ (í•´ë‹¹í•˜ëŠ” ê²½ìš°)
   â””â”€ 8081 í¬íŠ¸ ëŒ€ê¸° ì¤‘

ëª¨ë‹ˆí„°ë§ ì§€í‘œ:
- CPU ì‚¬ìš©ë¥ : 5-10%
- ë©”ëª¨ë¦¬: 120-200MB
- ë„¤íŠ¸ì›Œí¬: 5-50 Mbps
```

#### âŒ Failed (ì‹¤íŒ¨)

```
ìƒí™©: ì»¨í…Œì´ë„ˆê°€ ì—ëŸ¬ë¡œ ì¢…ë£Œë¨

ì¼ë°˜ì ì¸ ì›ì¸:
1. ì½”ë“œ ì—ëŸ¬
   â””â”€ Python exception, segmentation fault

2. ì˜ì¡´ì„± ë¬¸ì œ
   â””â”€ zenoh ì—°ê²° ì‹¤íŒ¨, ROS2 ë…¸ë“œ ì—°ê²° ì•ˆë¨

3. ë¦¬ì†ŒìŠ¤ ë¶€ì¡±
   â””â”€ OOM (Out of Memory) killed

4. ì„¤ì • ì˜¤ë¥˜
   â””â”€ ì˜ëª»ëœ í™˜ê²½ ë³€ìˆ˜, íŒŒì¼ ì—†ìŒ

ë””ë²„ê¹…:
$ podman logs kuksa-bridge
ERROR: Failed to connect to zenoh router
Traceback (most recent call last):
  File "kuksa_zenoh_bridge.py", line 45
    zenoh_session = zenoh.open()
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ConnectionError: Cannot connect to zenoh

ì¬ì‹œì‘ ì—¬ë¶€:
restartPolicy: ON_FAILURE â†’ ìë™ ì¬ì‹œì‘
restartPolicy: NEVER â†’ ì¬ì‹œì‘ ì•ˆí•¨
```

#### ğŸ Succeeded (ì„±ê³µ ì™„ë£Œ)

```
ìƒí™©: ì»¨í…Œì´ë„ˆê°€ ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë¨ (exit code 0)

ì˜ˆì‹œ:
- í•œ ë²ˆë§Œ ì‹¤í–‰í•˜ëŠ” ì‘ì—… (batch job)
- ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
- ë°±ì—… ì‘ì—…

restartPolicy ë™ì‘:
- ALWAYS: ë‹¤ì‹œ ì‹œì‘ (ë¬´í•œ ë£¨í”„)
- ON_FAILURE: ì‹œì‘ ì•ˆí•¨ (ì •ìƒ ì¢…ë£Œ)
- NEVER: ì‹œì‘ ì•ˆí•¨
```

#### ğŸ›‘ Stopped (ì¤‘ì§€ë¨)

```
ìƒí™©: ì‚¬ìš©ìê°€ ì˜ë„ì ìœ¼ë¡œ ì¤‘ì§€í•¨

ì¤‘ì§€ ë°©ë²•:
$ ank -k delete workload kuksa-bridge

ë‚´ë¶€ ë™ì‘:
1. Server â†’ Agent: "kuksa-bridge ì¤‘ì§€ ìš”ì²­"
2. Agent â†’ Podman: podman stop kuksa-bridge
3. SIGTERM ì‹ í˜¸ ì „ì†¡ (graceful shutdown)
4. 10ì´ˆ ëŒ€ê¸°
5. ì—¬ì „íˆ ì‹¤í–‰ ì¤‘ì´ë©´ SIGKILL (ê°•ì œ ì¢…ë£Œ)

ì¬ì‹œì‘ ë°©ë²•:
$ ank -k apply ankaios_manifest.yaml
# ë˜ëŠ” manifestì— ë‹¤ì‹œ ì¶”ê°€
```

---

## 5. ì˜ì¡´ì„± ê´€ë¦¬

### 5.1 ì˜ì¡´ì„± íƒ€ì…

#### ADD_COND_RUNNING (ê°€ì¥ ì¼ë°˜ì )

```yaml
workloads:
  kuksa-bridge:
    dependencies:
      zenoh-router: ADD_COND_RUNNING  # â† ì´ íƒ€ì…
      carla-spawner: ADD_COND_RUNNING
```

**ì˜ë¯¸**:
```
"zenoh-routerê°€ Running ìƒíƒœê°€ ë˜ì–´ì•¼ë§Œ
 kuksa-bridgeë¥¼ ì‹œì‘í•  ìˆ˜ ìˆë‹¤"
```

**íƒ€ì„ë¼ì¸**:
```
T=0s   zenoh-router: Pending â†’ Starting
T=2s   zenoh-router: Starting â†’ Running âœ“
T=2s   kuksa-bridge: Pending â†’ Starting (ì˜ì¡´ì„± ì¶©ì¡±!)
T=4s   kuksa-bridge: Starting â†’ Running âœ“
```

#### ADD_COND_SUCCEEDED

```yaml
workloads:
  main-app:
    dependencies:
      database-migration: ADD_COND_SUCCEEDED
```

**ì˜ë¯¸**:
```
"database-migrationì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì–´ì•¼
 main-appì„ ì‹œì‘í•  ìˆ˜ ìˆë‹¤"
```

**ì‚¬ìš© ì˜ˆì‹œ**:
```
1. database-migration ì‹¤í–‰
   â””â”€ DB ìŠ¤í‚¤ë§ˆ ì—…ë°ì´íŠ¸
   â””â”€ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
   â””â”€ exit 0 (ì„±ê³µ)

2. main-app ì‹œì‘
   â””â”€ ì´ë¯¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œëœ DB ì‚¬ìš©
```

#### ADD_COND_FAILED

```yaml
workloads:
  fallback-service:
    dependencies:
      primary-service: ADD_COND_FAILED
```

**ì˜ë¯¸**:
```
"primary-serviceê°€ ì‹¤íŒ¨í–ˆì„ ë•Œë§Œ
 fallback-serviceë¥¼ ì‹œì‘í•œë‹¤"
```

**ì‚¬ìš© ì˜ˆì‹œ** (Failover):
```
1. primary-service ì‹œì‘ ì‹œë„
   â””â”€ ì—°ê²° ì‹¤íŒ¨ (ë©”ì¸ ì„œë²„ ë‹¤ìš´)
   â””â”€ Failed ìƒíƒœ

2. fallback-service ìë™ ì‹œì‘
   â””â”€ ë°±ì—… ì„œë²„ë¡œ ì „í™˜
```

### 5.2 ë³µì¡í•œ ì˜ì¡´ì„± ì˜ˆì‹œ

#### ì˜ˆì‹œ 1: ìˆœì°¨ì  ì˜ì¡´ì„±

```yaml
workloads:
  # 1ë‹¨ê³„: ì¸í”„ë¼
  database:
    dependencies: {}

  message-queue:
    dependencies: {}

  # 2ë‹¨ê³„: ë°±ì—”ë“œ ì„œë¹„ìŠ¤
  auth-service:
    dependencies:
      database: ADD_COND_RUNNING

  user-service:
    dependencies:
      database: ADD_COND_RUNNING
      auth-service: ADD_COND_RUNNING

  # 3ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ
  web-frontend:
    dependencies:
      auth-service: ADD_COND_RUNNING
      user-service: ADD_COND_RUNNING
```

**ì‹œì‘ ìˆœì„œ**:
```
ì‹œê°„ì¶• â†’

T=0s: [database] [message-queue]  â† ë™ì‹œ ì‹œì‘ (ì˜ì¡´ì„± ì—†ìŒ)
       â†“
T=5s: [auth-service]  â† databaseê°€ Running
       â†“
T=8s: [user-service]  â† database + auth-service Running
       â†“
T=12s: [web-frontend]  â† auth + user ì„œë¹„ìŠ¤ Running
```

#### ì˜ˆì‹œ 2: ë³‘ë ¬ ì˜ì¡´ì„±

```yaml
workloads:
  shared-cache:
    dependencies: {}

  # ì´ ì…‹ì€ cacheë§Œ í•„ìš” (ì„œë¡œ ë…ë¦½ì )
  api-server-1:
    dependencies:
      shared-cache: ADD_COND_RUNNING

  api-server-2:
    dependencies:
      shared-cache: ADD_COND_RUNNING

  api-server-3:
    dependencies:
      shared-cache: ADD_COND_RUNNING
```

**ì‹œì‘ ìˆœì„œ**:
```
T=0s: [shared-cache]
       â†“
T=3s: [api-1] [api-2] [api-3]  â† ë™ì‹œ ì‹œì‘!
      (ì„œë¡œ ì˜ì¡´í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë³‘ë ¬ ê°€ëŠ¥)
```

### 5.3 ì˜ì¡´ì„± ì²´ì¸ ë””ë²„ê¹…

#### ìƒí™©: kuksa-bridgeê°€ ì‹œì‘ ì•ˆë¨

```bash
# 1ë‹¨ê³„: ìƒíƒœ í™•ì¸
$ ank -k get workload kuksa-bridge
Name: kuksa-bridge
State: Pending
Dependencies:
  - zenoh-router: WAITING (Current: Starting)
  - carla-spawner: WAITING (Current: Failed)

# 2ë‹¨ê³„: ì˜ì¡´ì„± í™•ì¸
$ ank -k get workload zenoh-router
State: Starting  # â† ì•„ì§ Runningì´ ì•„ë‹˜

$ ank -k get workload carla-spawner
State: Failed  # â† ë¬¸ì œ ë°œê²¬!
Error: Cannot connect to CARLA simulator

# 3ë‹¨ê³„: ë¬¸ì œ í•´ê²°
# CARLA ì‹œë®¬ë ˆì´í„°ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
$ nc -z localhost 2000
Connection refused  # â† CARLAê°€ ì•ˆ ì¼œì ¸ìˆìŒ!

# CARLA ì‹œì‘
$ cd /opt/carla && ./CarlaUE4.sh

# 4ë‹¨ê³„: ì¬ì‹œë„
# carla-spawnerê°€ ìë™ìœ¼ë¡œ ì¬ì‹œì‘ë¨ (ON_FAILURE)
# â†’ Running ìƒíƒœ
# â†’ kuksa-bridgeì˜ ì˜ì¡´ì„± ì¶©ì¡±
# â†’ kuksa-bridge ìë™ ì‹œì‘!
```

---

## 6. ì¬ì‹œì‘ ì •ì±…

### 6.1 ALWAYS (í•­ìƒ ì¬ì‹œì‘)

```yaml
workloads:
  zenoh-router:
    restartPolicy: ALWAYS
```

**ë™ì‘ ë°©ì‹**:
```
Container ì¢…ë£Œ (ì–´ë–¤ ì´ìœ ë“ )
    â†“
Ankaios ê°ì§€
    â†“
ì¦‰ì‹œ ì¬ì‹œì‘
    â†“
Running ìƒíƒœ ë³µêµ¬
```

**ì‚¬ìš© ì¼€ì´ìŠ¤**:
```
âœ“ í†µì‹  ë¯¸ë“¤ì›¨ì–´ (zenoh, MQTT broker)
âœ“ ë°ì´í„°ë² ì´ìŠ¤
âœ“ í•„ìˆ˜ ì¸í”„ë¼ ì„œë¹„ìŠ¤
âœ“ "ì ˆëŒ€ ì£½ìœ¼ë©´ ì•ˆë˜ëŠ”" ì„œë¹„ìŠ¤
```

**ì˜ˆì‹œ ì‹œë‚˜ë¦¬ì˜¤**:
```
T=0s    zenoh-router: Running
T=100s  ëˆ„êµ°ê°€ ì‹¤ìˆ˜ë¡œ ì»¨í…Œì´ë„ˆ ì¢…ë£Œ
        $ podman stop zenoh-router
T=100s  Ankaios ê°ì§€: "zenoh-routerê°€ ë©ˆì·„ë‹¤!"
T=101s  Ankaios ìë™ ì¬ì‹œì‘
T=103s  zenoh-router: Running (ë³µêµ¬ ì™„ë£Œ)
```

**ì¬ì‹œì‘ íšŸìˆ˜ ì œí•œ**:
```
AnkaiosëŠ” ë¬´í•œ ì¬ì‹œì‘ì„ ì‹œë„í•˜ì§€ë§Œ,
ë°±ì˜¤í”„(backoff) ì „ëµ ì‚¬ìš©:

1ë²ˆì§¸ ì¬ì‹œì‘: ì¦‰ì‹œ
2ë²ˆì§¸ ì¬ì‹œì‘: 5ì´ˆ í›„
3ë²ˆì§¸ ì¬ì‹œì‘: 10ì´ˆ í›„
4ë²ˆì§¸ ì¬ì‹œì‘: 20ì´ˆ í›„
5ë²ˆì§¸ ì´ìƒ: 30ì´ˆ í›„ (ìµœëŒ€)

ì´ìœ : ê³„ì† ì‹¤íŒ¨í•˜ëŠ” ì„œë¹„ìŠ¤ê°€
      ì‹œìŠ¤í…œì„ ê³¼ë¶€í•˜ì‹œí‚¤ì§€ ì•Šë„ë¡
```

### 6.2 ON_FAILURE (ì‹¤íŒ¨ ì‹œë§Œ ì¬ì‹œì‘)

```yaml
workloads:
  kuksa-bridge:
    restartPolicy: ON_FAILURE
```

**ë™ì‘ ë°©ì‹**:
```
Container ì¢…ë£Œ
    â†“
Exit Code í™•ì¸
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Exit 0      â”‚ Exit != 0    â”‚
â”‚ (ì •ìƒ ì¢…ë£Œ)  â”‚ (ì—ëŸ¬ ì¢…ë£Œ)   â”‚
â”‚     â†“       â”‚     â†“        â”‚
â”‚ ì¬ì‹œì‘ ì•ˆí•¨  â”‚ ì¬ì‹œì‘ í•¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì‚¬ìš© ì¼€ì´ìŠ¤**:
```
âœ“ ëŒ€ë¶€ë¶„ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤
âœ“ ì—ëŸ¬ëŠ” ë³µêµ¬í•˜ê³  ì‹¶ì§€ë§Œ ì •ìƒ ì¢…ë£ŒëŠ” ê·¸ëŒ€ë¡œ ë‘ê³  ì‹¶ì€ ê²½ìš°
âœ“ ë°°ì¹˜ ì‘ì—… (ì„±ê³µí•˜ë©´ ë, ì‹¤íŒ¨í•˜ë©´ ì¬ì‹œë„)
```

**ì˜ˆì‹œ ì‹œë‚˜ë¦¬ì˜¤ 1 - ì—ëŸ¬ë¡œ ì¢…ë£Œ**:
```
T=0s    kuksa-bridge: Running
T=50s   Python exception ë°œìƒ
        Traceback...
        sys.exit(1)  # â† Exit code 1
T=50s   Ankaios ê°ì§€: "ë¹„ì •ìƒ ì¢…ë£Œ!"
T=51s   ìë™ ì¬ì‹œì‘
T=53s   kuksa-bridge: Running (ë³µêµ¬)
```

**ì˜ˆì‹œ ì‹œë‚˜ë¦¬ì˜¤ 2 - ì •ìƒ ì¢…ë£Œ**:
```
T=0s    batch-job: Running
T=30s   ì‘ì—… ì™„ë£Œ
        print("Migration complete!")
        sys.exit(0)  # â† Exit code 0
T=30s   Ankaios ê°ì§€: "ì •ìƒ ì™„ë£Œ"
T=30s   ì¬ì‹œì‘ ì•ˆí•¨
        State: Succeeded
```

### 6.3 NEVER (ì¬ì‹œì‘ ì•ˆí•¨)

```yaml
workloads:
  one-time-setup:
    restartPolicy: NEVER
```

**ë™ì‘ ë°©ì‹**:
```
Container ì¢…ë£Œ
    â†“
ê·¸ëƒ¥ ë
    â†“
State: Stopped ë˜ëŠ” Failed
```

**ì‚¬ìš© ì¼€ì´ìŠ¤**:
```
âœ“ ì´ˆê¸° ì„¤ì • ì‘ì—…
âœ“ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
âœ“ ë°±ì—… ì‘ì—…
âœ“ "í•œ ë²ˆë§Œ ì‹¤í–‰í•˜ë©´ ë˜ëŠ”" ì‘ì—…
```

### 6.4 ì¬ì‹œì‘ ì •ì±… ë¹„êµí‘œ

| ìƒí™© | ALWAYS | ON_FAILURE | NEVER |
|------|--------|------------|-------|
| Exit 0 (ì •ìƒ) | âœ… ì¬ì‹œì‘ | âŒ ì•ˆí•¨ | âŒ ì•ˆí•¨ |
| Exit 1 (ì—ëŸ¬) | âœ… ì¬ì‹œì‘ | âœ… ì¬ì‹œì‘ | âŒ ì•ˆí•¨ |
| ìˆ˜ë™ ì¢…ë£Œ | âœ… ì¬ì‹œì‘ | âŒ ì•ˆí•¨ | âŒ ì•ˆí•¨ |
| OOM Killed | âœ… ì¬ì‹œì‘ | âœ… ì¬ì‹œì‘ | âŒ ì•ˆí•¨ |

---

## 7. í†µì‹  í”„ë¡œí† ì½œ

### 7.1 CLI â†” Server

**í”„ë¡œí† ì½œ**: HTTP/gRPC

```
ì‚¬ìš©ì
  â†“
$ ank -k get workloads
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ank (CLI)              â”‚
â”‚                         â”‚
â”‚  1. ëª…ë ¹ì–´ íŒŒì‹±          â”‚
â”‚  2. HTTP ìš”ì²­ ìƒì„±       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    HTTP GET
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ankaios Server         â”‚
â”‚                         â”‚
â”‚  1. ìš”ì²­ ì²˜ë¦¬            â”‚
â”‚  2. ìƒíƒœ ì¡°íšŒ            â”‚
â”‚  3. JSON ì‘ë‹µ ìƒì„±       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    HTTP Response
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ank (CLI)              â”‚
â”‚                         â”‚
â”‚  1. JSON íŒŒì‹±            â”‚
â”‚  2. í¬ë§·íŒ…               â”‚
â”‚  3. í„°ë¯¸ë„ ì¶œë ¥          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìš”ì²­ ì˜ˆì‹œ**:
```bash
$ ank -k get workloads

# ë‚´ë¶€ì ìœ¼ë¡œ ë³€í™˜:
GET http://localhost:25551/api/v1/workloads
Headers:
  Accept: application/json
  Authorization: Bearer <token>  # (ì¸ì¦ í™œì„±í™” ì‹œ)
```

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "workloads": [
    {
      "name": "zenoh-router",
      "agent": "police_agent",
      "state": "Running",
      "restartPolicy": "ALWAYS",
      "containers": [
        {
          "id": "abc123def456",
          "status": "running",
          "started_at": "2025-10-01T09:00:00Z"
        }
      ]
    },
    ...
  ]
}
```

### 7.2 Server â†” Agent

**í”„ë¡œí† ì½œ**: gRPC (Google Remote Procedure Call)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         gRPC          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ankaios Server  â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  Ankaios Agent   â”‚
â”‚  (í¬íŠ¸: 25551)   â”‚                       â”‚  (í´ë¼ì´ì–¸íŠ¸)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë©”ì‹œì§€ í¬ë§·: Protocol Buffers (protobuf)
íŠ¹ì§•:
- ë°”ì´ë„ˆë¦¬ í”„ë¡œí† ì½œ (ë¹ ë¦„)
- ì–‘ë°©í–¥ ìŠ¤íŠ¸ë¦¬ë°
- íƒ€ì… ì•ˆì •ì„±
```

**ë©”ì‹œì§€ ì˜ˆì‹œ** (Protobuf ì •ì˜):
```protobuf
// ì›Œí¬ë¡œë“œ ì‹œì‘ ìš”ì²­
message StartWorkloadRequest {
  string workload_name = 1;
  string agent_name = 2;
  string runtime = 3;
  RuntimeConfig runtime_config = 4;
}

// ìƒíƒœ ì—…ë°ì´íŠ¸
message WorkloadStateUpdate {
  string workload_name = 1;
  WorkloadState state = 2;
  string container_id = 3;
  string error_message = 4;
}

enum WorkloadState {
  PENDING = 0;
  STARTING = 1;
  RUNNING = 2;
  FAILED = 3;
  SUCCEEDED = 4;
}
```

**ì‹¤ì œ í†µì‹  íë¦„**:
```
Server â†’ Agent (StartWorkloadRequest)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ workload_name: "kuksa-bridge"      â”‚
â”‚ agent_name: "police_agent"         â”‚
â”‚ runtime: "podman"                  â”‚
â”‚ runtime_config: {                  â”‚
â”‚   image: "police-kuksa-bridge"     â”‚
â”‚   command_options: ["--network"... â”‚
â”‚ }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
Agent â†’ Server (Acknowledgement)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ status: "ACCEPTED"                 â”‚
â”‚ message: "Starting workload..."    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
Agent â†’ Server (StateUpdate - ì£¼ê¸°ì )
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ workload_name: "kuksa-bridge"      â”‚
â”‚ state: RUNNING                     â”‚
â”‚ container_id: "xyz789"             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 Agent â†” Podman

**í”„ë¡œí† ì½œ**: HTTP/REST API (Podman API)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTP REST    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ankaios Agent   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  Podman API      â”‚
â”‚                  â”‚                  â”‚  (Unix Socket)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì—”ë“œí¬ì¸íŠ¸: unix:///run/user/1000/podman/podman.sock
í¬ë§·: JSON
```

**API í˜¸ì¶œ ì˜ˆì‹œ**:

**1. ì»¨í…Œì´ë„ˆ ìƒì„±**:
```bash
POST /v1.40/containers/create?name=kuksa-bridge
Content-Type: application/json

{
  "Image": "localhost/police-kuksa-bridge:latest",
  "HostConfig": {
    "NetworkMode": "host",
    "Binds": [
      "/home/seame/workspace:/workspace:Z"
    ]
  },
  "Env": [
    "ROS_DOMAIN_ID=0",
    "PYTHONUNBUFFERED=1"
  ],
  "Cmd": [
    "python3",
    "/workspace/kuksa_zenoh_bridge.py"
  ]
}

Response:
{
  "Id": "abc123def456...",
  "Warnings": []
}
```

**2. ì»¨í…Œì´ë„ˆ ì‹œì‘**:
```bash
POST /v1.40/containers/abc123def456/start

Response: 204 No Content
```

**3. ìƒíƒœ ì¡°íšŒ**:
```bash
GET /v1.40/containers/abc123def456/json

Response:
{
  "Id": "abc123def456...",
  "State": {
    "Status": "running",
    "Running": true,
    "Pid": 12345,
    "StartedAt": "2025-10-01T09:05:30Z"
  },
  "Name": "kuksa-bridge",
  ...
}
```

---

## 8. ì‹¤ì „ ì‹œë‚˜ë¦¬ì˜¤

### 8.1 ì •ìƒ ì‹œì‘ ì‹œë‚˜ë¦¬ì˜¤

```
T=0s
User: ./start_ankaios.sh

T=1s
System: Ankaios Server ì‹œì‘
Log: [INFO] Server listening on :25551

T=2s
System: Ankaios Agent ì—°ê²°
Log: [INFO] Agent 'police_agent' connected

T=3s
User: ank -k apply ankaios_manifest.yaml
Server: Manifest íŒŒì‹± ì™„ë£Œ, 6ê°œ ì›Œí¬ë¡œë“œ ë°œê²¬

T=4s
Server â†’ Agent: "zenoh-router ì‹œì‘"
Agent â†’ Podman: podman run eclipse/zenoh:latest
Log: [INFO] Starting workload 'zenoh-router'

T=6s
Podman: ì»¨í…Œì´ë„ˆ ì‹œì‘ ì™„ë£Œ
Agent â†’ Server: "zenoh-router Running"
Log: [INFO] Workload 'zenoh-router' is Running

T=7s
Server: zenoh-router Running í™•ì¸
Server: carla-spawner ì˜ì¡´ì„± ì¶©ì¡± í™•ì¸
Server â†’ Agent: "carla-spawner ì‹œì‘"

T=8s
Agent â†’ Podman: podman run police-carla-spawner
Podman: ì»¨í…Œì´ë„ˆ ì‹œì‘
CARLA: ì°¨ëŸ‰ ìŠ¤í° ì‹œì‘...

T=13s
CARLA: Tesla Model 3 ìŠ¤í° ì™„ë£Œ
Agent â†’ Server: "carla-spawner Running"
Server: kuksa-bridge, camera-bridge ì˜ì¡´ì„± ì¶©ì¡±

T=14s
Server â†’ Agent: "kuksa-bridge ì‹œì‘" (ë³‘ë ¬)
Server â†’ Agent: "camera-bridge ì‹œì‘" (ë³‘ë ¬)
Agent: ë‘ ì»¨í…Œì´ë„ˆ ë™ì‹œ ì‹œì‘

T=17s
Agent â†’ Server: "kuksa-bridge Running"
Agent â†’ Server: "camera-bridge Running"

T=18s
Server â†’ Agent: "camera-websocket ì‹œì‘"
Server â†’ Agent: "police-websocket ì‹œì‘"

T=21s
Agent â†’ Server: ë‘ WebSocket ì„œë²„ ëª¨ë‘ Running

T=22s
System: âœ… ëª¨ë“  ì›Œí¬ë¡œë“œ ì •ìƒ ì‹¤í–‰ ì¤‘!

User: firefox police_dashboard_enhanced.html
Dashboard: ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì‹  ì‹œì‘! ğŸ‰
```

### 8.2 ì»´í¬ë„ŒíŠ¸ ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤

```
T=0s
System: ëª¨ë“  ì›Œí¬ë¡œë“œ ì •ìƒ ì‹¤í–‰ ì¤‘

T=100s
Event: kuksa-bridgeì—ì„œ zenoh ì—°ê²° ëŠê¹€
kuksa-bridge: ERROR: Lost connection to zenoh router
kuksa-bridge: sys.exit(1)

T=100.5s
Podman: ì»¨í…Œì´ë„ˆ ì¢…ë£Œ ê°ì§€ (exit code 1)
Agent: ìƒíƒœ ë³€ê²½ ê°ì§€
Agent â†’ Server: "kuksa-bridge Failed"

T=101s
Server: ì¬ì‹œì‘ ì •ì±… í™•ì¸
  â””â”€ restartPolicy: ON_FAILURE âœ“
  â””â”€ Exit code: 1 (ë¹„ì •ìƒ) âœ“
  â””â”€ ê²°ì •: ì¬ì‹œì‘!

Server â†’ Agent: "kuksa-bridge ì¬ì‹œì‘"
Log: [INFO] Restarting failed workload 'kuksa-bridge'

T=102s
Agent â†’ Podman: podman run police-kuksa-bridge
Podman: ìƒˆ ì»¨í…Œì´ë„ˆ ìƒì„± ë° ì‹œì‘

T=104s
kuksa-bridge: zenoh ì—°ê²° ì„±ê³µ!
kuksa-bridge: VSS ë°ì´í„° ìˆ˜ì‹  ì‹œì‘
Agent â†’ Server: "kuksa-bridge Running"

T=105s
System: âœ… ì¥ì•  ë³µêµ¬ ì™„ë£Œ!
Downtime: 5ì´ˆ

Dashboard: ë°ì´í„° ìŠ¤íŠ¸ë¦¼ ì¬ê°œ
User: ì¥ì• ë¥¼ ê±°ì˜ ëˆˆì¹˜ì±„ì§€ ëª»í•¨
```

### 8.3 ì˜ì¡´ì„± ì¥ì•  ì „íŒŒ ì‹œë‚˜ë¦¬ì˜¤

```
T=0s
System: ëª¨ë“  ì›Œí¬ë¡œë“œ ì •ìƒ ì‹¤í–‰

T=200s
Event: zenoh-router í¬ë˜ì‹œ!
  (ë©”ëª¨ë¦¬ ë¶€ì¡±ìœ¼ë¡œ OOM Killed)

T=200.5s
Agent â†’ Server: "zenoh-router Failed"
Server: ì¬ì‹œì‘ ì •ì±… í™•ì¸ (ALWAYS)

T=201s
Server â†’ Agent: "zenoh-router ì¦‰ì‹œ ì¬ì‹œì‘"

T=201s (ë™ì‹œì—)
kuksa-bridge: ERROR: zenoh connection lost
camera-bridge: ERROR: zenoh connection lost
camera-websocket: ERROR: Cannot receive frames
police-websocket: ERROR: No data from zenoh

T=202s
kuksa-bridge: ì¬ì—°ê²° ì‹œë„ ì¤‘...
camera-bridge: ì¬ì—°ê²° ì‹œë„ ì¤‘...
(ì¬ì‹œì‘ì€ ì•ˆë¨ - í”„ë¡œì„¸ìŠ¤ ìì²´ëŠ” ì‚´ì•„ìˆìŒ)

T=203s
zenoh-router: ì¬ì‹œì‘ ì™„ë£Œ
Agent â†’ Server: "zenoh-router Running"

T=204s
kuksa-bridge: âœ… zenoh ì¬ì—°ê²° ì„±ê³µ
camera-bridge: âœ… zenoh ì¬ì—°ê²° ì„±ê³µ
camera-websocket: âœ… ë°ì´í„° ìˆ˜ì‹  ì¬ê°œ
police-websocket: âœ… ë°ì´í„° ìˆ˜ì‹  ì¬ê°œ

T=205s
System: âœ… ì „ì²´ ì‹œìŠ¤í…œ ë³µêµ¬ ì™„ë£Œ!
Total downtime: 5ì´ˆ

êµí›ˆ:
- zenoh-routerëŠ” ALWAYS ì •ì±…ì´ë¼ ì¦‰ì‹œ ì¬ì‹œì‘
- ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë“¤ì€ ì¬ì—°ê²° ë¡œì§ ë•ë¶„ì— ì‚´ì•„ë‚¨ìŒ
- ì˜ì¡´ì„± ê³„ì¸µ êµ¬ì¡°ê°€ ë³µêµ¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰
```

### 8.4 ìˆ˜ë™ ì—…ë°ì´íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

```
T=0s
User: kuksa-bridge ì½”ë“œ ìˆ˜ì •í•¨
  â””â”€ ìƒˆ ê¸°ëŠ¥ ì¶”ê°€: ê¸´ê¸‰ ì•Œë¦¼ í•„í„°ë§

T=1s
User: ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì¬ë¹Œë“œ
$ cd /workspace
$ podman build -t localhost/police-kuksa-bridge:latest \
    -f Dockerfile.kuksa-bridge .
Build: âœ… ì„±ê³µ (30ì´ˆ ì†Œìš”)

T=31s
User: ìƒˆ ì´ë¯¸ì§€ë¡œ ì—…ë°ì´íŠ¸
$ ank -k delete workload kuksa-bridge
Agent: ì»¨í…Œì´ë„ˆ ì •ìƒ ì¢…ë£Œ ì‹œì‘
Podman: SIGTERM â†’ SIGKILL (10ì´ˆ timeout)

T=33s
Agent â†’ Server: "kuksa-bridge Stopped"

T=34s
User: ìƒˆ manifest ì ìš© (ë˜ëŠ” ìë™ ì¬ì‹œì‘)
$ ank -k apply ankaios_manifest.yaml
Server: kuksa-bridge ì •ì˜ ë°œê²¬

T=35s
Server: ì˜ì¡´ì„± í™•ì¸
  â””â”€ zenoh-router: Running âœ“
  â””â”€ carla-spawner: Running âœ“
  â””â”€ ì‹œì‘ ê°€ëŠ¥!

Server â†’ Agent: "kuksa-bridge ì‹œì‘"
  (ìƒˆ ì´ë¯¸ì§€ ì‚¬ìš©)

T=37s
Podman: ìƒˆ ì´ë¯¸ì§€ë¡œ ì»¨í…Œì´ë„ˆ ìƒì„±
kuksa-bridge (new): ì‹œì‘
kuksa-bridge (new): ìƒˆ ê¸°ëŠ¥ìœ¼ë¡œ ì‹¤í–‰ ì¤‘!

T=38s
Agent â†’ Server: "kuksa-bridge Running"

T=39s
System: âœ… ë¬´ì¤‘ë‹¨ ì—…ë°ì´íŠ¸ ì™„ë£Œ!

User: ë¡œê·¸ í™•ì¸
$ podman logs kuksa-bridge
[INFO] Starting with emergency alert filtering (NEW!)
[INFO] Connected to zenoh
[INFO] Subscribed to police/vss_data
[INFO] Emergency filter: ENABLED âœ“
```

---

## 9. ë¬¸ì œ í•´ê²°

### 9.1 ì›Œí¬ë¡œë“œê°€ ì‹œì‘ ì•ˆë¨

#### ì¦ìƒ
```bash
$ ank -k get workloads
NAME            AGENT           STATE
kuksa-bridge    police_agent    Pending
```

#### ì§„ë‹¨ ë‹¨ê³„

**1ë‹¨ê³„: ì˜ì¡´ì„± í™•ì¸**
```bash
$ ank -k get workload kuksa-bridge

Output:
Name: kuksa-bridge
State: Pending
Dependencies:
  - zenoh-router: WAITING (Current: Failed)
  - carla-spawner: OK (Current: Running)

ğŸ” ë¬¸ì œ ë°œê²¬: zenoh-routerê°€ Failed ìƒíƒœ!
```

**2ë‹¨ê³„: ì‹¤íŒ¨í•œ ì›Œí¬ë¡œë“œ ì¡°ì‚¬**
```bash
$ ank -k get workload zenoh-router

Output:
Name: zenoh-router
State: Failed
Last Error: Container exited with code 1
Restart Count: 5
Last Restart: 30s ago

ğŸ” ê³„ì† ì¬ì‹œì‘ ì¤‘ì´ì§€ë§Œ ê³„ì† ì‹¤íŒ¨
```

**3ë‹¨ê³„: ë¡œê·¸ í™•ì¸**
```bash
$ podman logs zenoh-router

Output:
Error: Address already in use (os error 98)
Error: Cannot bind to 0.0.0.0:7447

ğŸ” í¬íŠ¸ ì¶©ëŒ ë°œê²¬!
```

**4ë‹¨ê³„: í¬íŠ¸ ì‚¬ìš© í™•ì¸**
```bash
$ ss -tlnp | grep 7447

Output:
LISTEN 0 128 0.0.0.0:7447 0.0.0.0:* users:(("zenohd",pid=1234))

ğŸ” ì´ë¯¸ ë‹¤ë¥¸ zenohd í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ ì¤‘!
```

**5ë‹¨ê³„: í•´ê²°**
```bash
# ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
$ pkill zenohd

# ë˜ëŠ” ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì •ë¦¬
$ podman stop zenoh-router-old
$ podman rm zenoh-router-old

# Ankaiosê°€ ìë™ìœ¼ë¡œ ì¬ì‹œì‘
# (restartPolicy: ALWAYS)

# í™•ì¸
$ ank -k get workload zenoh-router
State: Running âœ“
```

### 9.2 ì»¨í…Œì´ë„ˆê°€ ê³„ì† ì¬ì‹œì‘ë¨

#### ì¦ìƒ
```bash
$ ank -k get workload carla-spawner

Output:
State: Running
Restart Count: 47  # â† ë„ˆë¬´ ë§ìŒ!
Last Restart: 5s ago
```

#### ì§„ë‹¨

**1ë‹¨ê³„: ë¡œê·¸ íŒ¨í„´ ë¶„ì„**
```bash
$ podman logs carla-spawner | tail -50

Output (ë°˜ë³µë¨):
[INFO] Connecting to CARLA...
[ERROR] Cannot connect to CARLA: Connection refused
[ERROR] Retrying in 5 seconds...
[ERROR] Max retries reached, exiting
Traceback...
sys.exit(1)
```

**2ë‹¨ê³„: CARLA ìƒíƒœ í™•ì¸**
```bash
$ nc -z localhost 2000
Connection refused  # â† CARLAê°€ ì•ˆ ì¼œì ¸ìˆìŒ!
```

**3ë‹¨ê³„: í•´ê²° ì˜µì…˜**

**ì˜µì…˜ A: CARLA ì‹œì‘**
```bash
$ cd /opt/carla-simulator
$ ./CarlaUE4.sh

# Ankaiosê°€ ìë™ìœ¼ë¡œ ì¬ì‹œë„
# â†’ ì´ë²ˆì—” ì„±ê³µ!
```

**ì˜µì…˜ B: ì¬ì‹œì‘ ì •ì±… ë³€ê²½ (ì„ì‹œ)**
```yaml
# manifest ìˆ˜ì •
workloads:
  carla-spawner:
    restartPolicy: NEVER  # ì¼ë‹¨ ë©ˆì¶¤
```
```bash
$ ank -k apply ankaios_manifest.yaml
# CARLA ì¤€ë¹„ë˜ë©´ ë‹¤ì‹œ ALWAYSë¡œ ë³€ê²½
```

### 9.3 Agentê°€ ì—°ê²° ì•ˆë¨

#### ì¦ìƒ
```bash
$ ank -k get workloads
Error: No agents connected

$ ank-agent --name police_agent
Error: Cannot connect to server at localhost:25551
```

#### ì§„ë‹¨ ë° í•´ê²°

**1ë‹¨ê³„: Server ì‹¤í–‰ í™•ì¸**
```bash
$ pgrep -a ank-server
(empty)  # â† Serverê°€ ì•ˆ ì¼œì ¸ìˆìŒ!
```

**í•´ê²°**:
```bash
$ ank-server &
[INFO] Server started on :25551

$ ank-agent --name police_agent &
[INFO] Connected to server
```

**2ë‹¨ê³„: ë„¤íŠ¸ì›Œí¬ í™•ì¸**
```bash
$ ss -tlnp | grep 25551
LISTEN 0 128 127.0.0.1:25551  # â† localhostë§Œ ë¦¬ìŠ¤ë‹

# ë‹¤ë¥¸ ë¨¸ì‹ ì˜ Agentë¥¼ ì—°ê²°í•˜ë ¤ë©´:
$ ank-server --bind 0.0.0.0:25551  # ëª¨ë“  ì¸í„°í˜ì´ìŠ¤
```

**3ë‹¨ê³„: ë°©í™”ë²½ í™•ì¸**
```bash
$ sudo ufw status
Status: active
To                         Action
--                         ------
25551                      DENY  # â† ì°¨ë‹¨ë¨!

# í•´ê²°
$ sudo ufw allow 25551/tcp
```

### 9.4 ì´ë¯¸ì§€ë¥¼ ëª» ì°¾ìŒ

#### ì¦ìƒ
```bash
$ ank -k get workload kuksa-bridge
State: Failed
Error: Image localhost/police-kuksa-bridge:latest not found
```

#### í•´ê²°
```bash
# 1. ì´ë¯¸ì§€ í™•ì¸
$ podman images | grep police
(empty)  # â† ì´ë¯¸ì§€ê°€ ì—†ìŒ

# 2. ì´ë¯¸ì§€ ë¹Œë“œ
$ ./build_containers.sh

# 3. í™•ì¸
$ podman images | grep police
localhost/police-base            latest    abc123    2 hours ago    2.1GB
localhost/police-kuksa-bridge    latest    def456    1 hour ago     2.2GB
...

# 4. Ankaios ì¬ì‹œë„
$ ank -k apply ankaios_manifest.yaml
# ë˜ëŠ” ìë™ìœ¼ë¡œ ì¬ì‹œì‘ë¨ (ON_FAILURE)
```

---

## 10. ê³ ê¸‰ í™œìš©

### 10.1 ë‹¤ì¤‘ ë…¸ë“œ ë°°í¬

**ì‹œë‚˜ë¦¬ì˜¤**: 3ëŒ€ì˜ ì»´í“¨í„°ë¡œ ì‹œìŠ¤í…œ ë¶„ì‚°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Computer 1 (ë©”ì¸)   â”‚
â”‚  - Ankaios Server   â”‚
â”‚  - Agent: main      â”‚
â”‚  - zenoh-router     â”‚
â”‚  - CARLA spawner    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚           â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
â”‚Computer 2â”‚ â”‚Computer 3â”‚
â”‚Agent:    â”‚ â”‚Agent:    â”‚
â”‚ compute1 â”‚ â”‚ compute2 â”‚
â”‚- kuksa   â”‚ â”‚- camera  â”‚
â”‚- bridge  â”‚ â”‚- bridge  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Manifest ì„¤ì •**:
```yaml
apiVersion: v0.1
workloads:
  # Computer 1ì—ì„œ ì‹¤í–‰
  zenoh-router:
    agent: main
    restartPolicy: ALWAYS

  carla-spawner:
    agent: main
    dependencies:
      zenoh-router: ADD_COND_RUNNING

  # Computer 2ì—ì„œ ì‹¤í–‰
  kuksa-bridge:
    agent: compute1
    dependencies:
      zenoh-router: ADD_COND_RUNNING
      carla-spawner: ADD_COND_RUNNING

  # Computer 3ì—ì„œ ì‹¤í–‰
  camera-bridge:
    agent: compute2
    dependencies:
      zenoh-router: ADD_COND_RUNNING
      carla-spawner: ADD_COND_RUNNING
```

**ì‹¤í–‰**:
```bash
# Computer 1 (ë©”ì¸)
$ ank-server --bind 0.0.0.0:25551 &
$ ank-agent --name main &

# Computer 2
$ ank-agent --name compute1 --server 192.168.1.100:25551 &

# Computer 3
$ ank-agent --name compute2 --server 192.168.1.100:25551 &

# Computer 1ì—ì„œ ë°°í¬
$ ank -k apply ankaios_manifest.yaml
```

### 10.2 ë¦¬ì†ŒìŠ¤ ì œí•œ

```yaml
workloads:
  carla-spawner:
    runtimeConfig: |
      image: police-carla-spawner:latest
      commandOptions: [
        "--memory", "4g",           # ìµœëŒ€ 4GB RAM
        "--memory-swap", "4g",      # ìŠ¤ì™‘ ë¹„í™œì„±í™”
        "--cpus", "2.0",            # ìµœëŒ€ 2 CPU
        "--cpu-shares", "1024"      # CPU ìš°ì„ ìˆœìœ„
      ]
```

### 10.3 í™˜ê²½ë³„ ì„¤ì •

**ê°œë°œ í™˜ê²½**:
```yaml
# dev-manifest.yaml
workloads:
  kuksa-bridge:
    runtimeConfig: |
      image: police-kuksa-bridge:dev
      commandOptions: [
        "-v", "/home/dev/code:/workspace:Z",  # ì½”ë“œ ë§ˆìš´íŠ¸
        "-e", "LOG_LEVEL=DEBUG"                # ë””ë²„ê·¸ ëª¨ë“œ
      ]
```

**í”„ë¡œë•ì…˜ í™˜ê²½**:
```yaml
# prod-manifest.yaml
workloads:
  kuksa-bridge:
    runtimeConfig: |
      image: police-kuksa-bridge:v1.2.3  # íƒœê·¸ëœ ë²„ì „
      commandOptions: [
        "--read-only",                    # ì½ê¸° ì „ìš© íŒŒì¼ì‹œìŠ¤í…œ
        "-e", "LOG_LEVEL=WARNING",        # ê²½ê³ ë§Œ
        "--security-opt", "no-new-privileges"  # ë³´ì•ˆ ê°•í™”
      ]
```

### 10.4 í—¬ìŠ¤ ì²´í¬

**Dockerfileì— ì¶”ê°€**:
```dockerfile
# Dockerfile.kuksa-bridge
HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
  CMD ros2 node list | grep kuksa_zenoh_bridge || exit 1
```

**Ankaiosê°€ ìë™ìœ¼ë¡œ**:
```
30ì´ˆë§ˆë‹¤ í—¬ìŠ¤ ì²´í¬ ì‹¤í–‰
  â†“
3ë²ˆ ì—°ì† ì‹¤íŒ¨
  â†“
ì»¨í…Œì´ë„ˆë¥¼ Failedë¡œ í‘œì‹œ
  â†“
ì¬ì‹œì‘ ì •ì±…ì— ë”°ë¼ ì¬ì‹œì‘
```

---

## ğŸ“ ìš”ì•½

### í•µì‹¬ ê°œë… ì •ë¦¬

1. **Ankaios = ìë™ì°¨ìš© ê°€ë²¼ìš´ Kubernetes**
2. **Server = ë‘ë‡Œ, Agent = ì¼ê¾¼, Podman = ì‹¤í–‰ ì—”ì§„**
3. **Manifest = ì›í•˜ëŠ” ìƒíƒœë¥¼ ì„ ì–¸**
4. **ì˜ì¡´ì„± = ìë™ ìˆœì„œ ê´€ë¦¬**
5. **ì¬ì‹œì‘ ì •ì±… = ìë™ ì¥ì•  ë³µêµ¬**

### ëª…ë ¹ì–´ ì¹˜íŠ¸ì‹œíŠ¸

```bash
# ì‹œì‘
./start_ankaios.sh

# ìƒíƒœ í™•ì¸
ank -k get workloads
ank -k get workload <name>

# ë¡œê·¸ í™•ì¸
podman logs <container-name>
podman logs -f <container-name>

# ì¬ì‹œì‘
ank -k delete workload <name>  # ìë™ ì¬ì‹œì‘ë¨

# ì¤‘ì§€
./stop_ankaios.sh
```

### ë¬¸ì œ í•´ê²° í”Œë¡œìš°

```
ë¬¸ì œ ë°œìƒ
  â†“
ank -k get workload <name>  â† ìƒíƒœ í™•ì¸
  â†“
ì˜ì¡´ì„± ë¬¸ì œ? â†’ ì˜ì¡´ì„± ì›Œí¬ë¡œë“œ í™•ì¸
  â†“
ì»¨í…Œì´ë„ˆ ë¬¸ì œ? â†’ podman logs í™•ì¸
  â†“
ì´ë¯¸ì§€ ë¬¸ì œ? â†’ podman images í™•ì¸
  â†“
í•´ê²° â†’ Ankaiosê°€ ìë™ ì¬ì‹œë„
```

ì´ì œ Ankaiosì˜ ëª¨ë“  ê²ƒì„ ì´í•´í•˜ì…¨ìŠµë‹ˆë‹¤! ğŸ‰
